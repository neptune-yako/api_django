# 测试环境页面 - 创建 Jenkins 节点功能

## 📍 功能位置

在**测试环境管理**页面的顶部标题栏:

```
┌────────────────────────────────────────────┐
│ 🖼️ 测试环境                                │
│    [环境]  [节点]  [刷新]                   │
│             ↑                              │
│         新增按钮                            │
└────────────────────────────────────────────┘
```

## ✨ 功能说明

点击**[节点]**按钮,会弹出"创建 Jenkins 节点"对话框,可以快速创建新的 SSH 类型的 Jenkins 节点。

## 📝 表单字段

### 必填字段

1. **节点名称** (必填)
   - 示例: `build-node-01`, `test-server-01`
   - 长度: 2-50 个字符
   - 说明: Jenkins 中的唯一节点标识

2. **主机IP/域名** (必填)
   - 示例: `192.168.1.100` 或 `build-server.company.com`
   - 说明: 节点机器的网络地址

### 可选字段

3. **SSH凭证ID**
   - 示例: `aliyun-ssh-key`, `build-server-credential`
   - 说明: Jenkins 中预先配置的 SSH 凭证 ID
   - 提示: 需要在 Jenkins → 凭据管理 中预先创建

4. **SSH端口**
   - 默认值: `22`
   - 范围: 1-65535
   - 说明: SSH 连接端口

5. **远程工作目录**
   - 默认值: `/home/jenkins`
   - 示例: `/opt/jenkins`, `/var/lib/jenkins`
   - 说明: 节点上的工作目录路径

6. **节点标签**
   - 示例: `linux docker java11 maven`
   - 说明: 多个标签用空格分隔,用于 Job 选择特定节点
   - 常用标签:
     - `linux`, `windows`, `macos` - 操作系统
     - `docker`, `k8s` - 容器技术
     - `java8`, `java11`, `java17` - Java 版本
     - `python3`, `nodejs` - 编程语言
     - `maven`, `gradle` - 构建工具

7. **执行器数量**
   - 默认值: `2`
   - 范围: 1-20
   - 说明: 节点可同时执行的构建任务数量

8. **节点描述**
   - 示例: `Production build server for Java projects`
   - 说明: 节点的用途说明

## 🎯 使用步骤

### 步骤 1: 打开对话框
1. 进入**测试环境管理**页面
2. 点击顶部的 **[节点]** 按钮
3. 弹出"创建 Jenkins 节点"对话框

### 步骤 2: 填写表单
1. 输入**节点名称** (如: `build-node-01`)
2. 输入**主机IP** (如: `192.168.1.100`)
3. 可选: 填写 **SSH凭证ID** (如果需要认证)
4. 可选: 设置其他参数(端口、目录、标签等)
5. 点击 **[创建节点]** 按钮

### 步骤 3: 等待创建
- ⏳ 系统会调用后端 API 创建节点
- 创建成功后显示成功提示
- 自动刷新 Jenkins 节点列表
- 💡 提示: 新节点可能需要几秒钟才能上线

## 📋 创建示例

### 示例 1: 创建基础构建节点

```
节点名称: build-node-01
主机IP: 192.168.1.100
SSH凭证ID: aliyun-ssh-key
SSH端口: 22
远程工作目录: /home/jenkins
节点标签: linux docker
执行器数量: 2
节点描述: General purpose build server
```

### 示例 2: 创建 Java 专用节点

```
节点名称: java-build-server
主机IP: 192.168.1.101
SSH凭证ID: java-server-key
节点标签: linux docker java11 maven gradle
执行器数量: 4
节点描述: Dedicated server for Java projects with Maven and Gradle
```

### 示例 3: 创建高并发测试节点

```
节点名称: test-runner-01
主机IP: 192.168.1.102
SSH凭证ID: test-server-key
节点标签: linux docker selenium chrome firefox
执行器数量: 10
节点描述: High concurrency test execution server
```

## ⚠️ 注意事项

### 创建前准备

1. **确保目标机器已配置**
   - ✅ 已安装 Java 运行环境 (JRE/JDK)
   - ✅ SSH 服务已启动
   - ✅ 防火墙已开放 SSH 端口
   - ✅ 创建了 jenkins 用户(或指定的用户)
   - ✅ 工作目录已创建并有写权限

2. **在 Jenkins 中配置 SSH 凭证**
   - 路径: Jenkins → Manage Jenkins → Credentials
   - 添加 SSH Username with private key
   - 记录凭证 ID,填写到创建表单中

3. **网络连通性**
   - Jenkins 主服务器能访问节点 IP
   - 节点能访问互联网(下载依赖)

### 常见问题

**Q1: 节点创建后一直显示离线?**
- 检查SSH凭证是否正确
- 检查目标机器是否安装 Java
- 查看 Jenkins 日志排查连接问题

**Q2: 凭证 ID 填什么?**
- 在 Jenkins → Credentials 中查看
- 如果没有配置,先去 Jenkins 创建
- 或者留空,创建后手动配置

**Q3: 执行器数量设置多少合适?**
- CPU 核心数的 1-2 倍
- 考虑内存限制
- 默认 2 个通常足够

## 🔄 创建后操作

创建成功后:

1. **查看节点状态**
   - 在环境列表中查看对应节点
   - 观察状态点颜色 (🟢在线 / 🔴离线)

2. **如果节点离线**
   - 点击"更多" → "重新连接"
   - 或点击"查看详情"查看离线原因

3. **配置节点标签**
   - 点击"标签"按钮
   - 根据节点能力添加标签

4. **测试节点**
   - 在 Jenkins 中创建测试 Job
   - 指定在新节点上运行
   - 验证节点是否正常工作

## 📊 节点管理流程

```
创建节点
   ↓
等待上线 (2-5秒)
   ↓
检查状态
   ├─ 在线 → 配置标签 → 开始使用
   └─ 离线 → 查看详情 → 排查问题 → 重新连接
```

## 🎨 UI 截图说明

```
┌─────────────────────────────────────────────────────┐
│  创建 Jenkins 节点                            [×]   │
├─────────────────────────────────────────────────────┤
│  节点名称 *    [build-node-01_______________]      │
│  主机IP/域名 * [192.168.1.100______________]       │
│  SSH凭证ID     [aliyun-ssh-key_____________]       │
│                提示: 需要在Jenkins中预先配置SSH凭证  │
│  SSH端口       [22   ▼]                            │
│  远程工作目录   [/home/jenkins_____________]        │
│  节点标签      [linux docker______________]         │
│  执行器数量    [2    ▼]                            │
│  节点描述      [________________________]           │
│               [________________________]            │
│               [________________________]            │
│                                                     │
│                        [取消]  [创建节点]           │
└─────────────────────────────────────────────────────┘
```

## 🚀 后续增强

可以考虑的功能:

1. **从模板创建** - 预设常用节点配置
2. **批量创建** - 一次创建多个节点
3. **克隆节点** - 基于现有节点创建
4. **凭证管理** - 在界面中管理 SSH 凭证

---

## 总结

现在您可以在测试环境页面直接创建 Jenkins 节点,无需切换到 Jenkins 管理界面,提高了工作效率! 🎉
