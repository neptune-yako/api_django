import{_ as L}from"./none-CwC0Lq_I.js";import{P as U}from"./ProStore-981bTmq_.js";import{c as A}from"./chart-Bt2xmhMA.js";import{t as k}from"./dateTools-APCdG_Ih.js";import{u as $,h as x,a as F,E as C,b as I}from"./index-Bqsb1G-Q.js";import{a as z,v as O,o as q,D as u,F as i,U as a,O as G,M as s,au as H,L as h,u as D,ao as d,aE as J,E as r,R as p,P as m,S as _}from"./vue-CXALzJrr.js";const K={class:"main"},Q={class:"card table",style:{padding:"10px"}},W={key:0},X={key:0},Y={key:0},Z={key:0},ee={key:1},te={class:"pagination",style:{margin:"5px 5px 0"}},pe={__name:"Record",setup(ae){const E=$(),R=J();let g=z([]);const B=U(),l=O({page:1,size:10,count:0}),f=z(!1);async function c(){f.value=!0;const n=await x.recordApi.getRecord({project:B.proList.id,page:l.page,size:l.size});g.value=n.data.results,l.count=n.data.count,S(),f.value=!1}let y=[],w=[];const S=function(){y=[],w=[],g.value.forEach(e=>{y.push(e.pass_rate),w.push(k.rDate(e.create_time))});const n=document.getElementById("chart_record");A.chart3(n,y,w,E.value)};function N(n){R.push({name:"report",params:{id:n.id}})}function V(n){F.confirm("此操作将永久删除该测试执行记录，是否继续？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(async()=>{const e=await x.recordApi.deleteRecord(n);e.status===204?(C({type:"success",title:"执行记录删除成功！",duration:1500}),await c()):C({title:"执行记录删除失败！",message:e.data.detail,type:"error",duration:1500})}).catch(()=>{I({type:"info",message:"已取消删除执行记录。",duration:1500})})}return q(async()=>{await c()}),(n,e)=>{const v=d("el-button"),o=d("el-table-column"),b=d("el-tag"),M=d("el-table"),P=d("el-pagination"),T=H("loading");return r(),u("div",K,[e[8]||(e[8]=i("div",{class:"card chart"},[i("div",{id:"chart_record",class:"box1",style:{height:"250px"}})],-1)),i("div",Q,[a(v,{plain:"",onClick:c,type:"success",icon:"Refresh",size:"small"},{default:s(()=>[...e[2]||(e[2]=[p("刷新",-1)])]),_:1}),G((r(),h(M,{data:D(g),style:{width:"100%"},stripe:"","header-cell-style":{"text-align":"center"},"cell-style":{"text-align":"center"},"element-loading-text":"加载中..."},{empty:s(()=>[...e[3]||(e[3]=[i("div",{class:"table-empty"},[i("img",{src:L,alt:"notData"}),i("div",null,"暂无数据")],-1)])]),default:s(()=>[a(o,{label:"序号",type:"index",width:"90"}),a(o,{prop:"plan",label:"计划名称"}),a(o,{prop:"env",label:"环境名称"}),a(o,{prop:"all",label:"总用例数"},{default:s(t=>[t.row.statue!=="执行中"?(r(),u("span",W,_(t.row.all),1)):m("",!0)]),_:1}),a(o,{prop:"success",label:"通过用例数"},{default:s(t=>[t.row.statue!=="执行中"?(r(),u("span",X,_(t.row.success),1)):m("",!0)]),_:1}),a(o,{prop:"pass_rate",label:"通过率"},{default:s(t=>[t.row.statue!=="执行中"?(r(),u("span",Y,_(t.row.pass_rate+"%"),1)):m("",!0)]),_:1}),a(o,{prop:"status",label:"执行状态"},{default:s(t=>[t.row.status==="执行完毕"?(r(),h(b,{key:0,type:"success"},{default:s(()=>[...e[4]||(e[4]=[p("执行完毕",-1)])]),_:1})):t.row.status==="执行中"?(r(),h(b,{key:1,type:"info"},{default:s(()=>[...e[5]||(e[5]=[p("执行中",-1)])]),_:1})):m("",!0)]),_:1}),a(o,{prop:"tester",label:"执行人"}),a(o,{label:"执行时间","min-width":"110"},{default:s(t=>[p(_(D(k).rTime(t.row.create_time)),1)]),_:1}),a(o,{label:"操作",width:"200"},{default:s(t=>[t.row.statue==="执行中"?(r(),u("span",Z,[a(b,null,{default:s(()=>[p(_(t.row.statue)+"...",1)]),_:2},1024)])):(r(),u("span",ee,[a(v,{onClick:j=>N(t.row),icon:"View",type:"success",plain:""},{default:s(()=>[...e[6]||(e[6]=[p("查看",-1)])]),_:1},8,["onClick"]),a(v,{onClick:j=>V(t.row.id),icon:"Delete",type:"danger",plain:""},{default:s(()=>[...e[7]||(e[7]=[p("删除",-1)])]),_:1},8,["onClick"])]))]),_:1})]),_:1},8,["data"])),[[T,f.value]]),i("div",te,[a(P,{"current-page":l.page,"onUpdate:currentPage":e[0]||(e[0]=t=>l.page=t),"page-size":l.size,"onUpdate:pageSize":e[1]||(e[1]=t=>l.size=t),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper",total:l.count,onCurrentChange:c,onSizeChange:c},null,8,["current-page","page-size","total"])])])])}}};export{pe as default};
