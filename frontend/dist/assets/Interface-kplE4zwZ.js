import{_ as M}from"./none-CwC0Lq_I.js";import{U as O,a as J,h as E,E as y,b as K}from"./index-Bqsb1G-Q.js";import{P as Q}from"./ProStore-981bTmq_.js";import{t as V}from"./dateTools-APCdG_Ih.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as k,v as P,o as X,D as Y,F as g,U as l,M as a,u as o,q as U,T as Z,ao as u,E as m,R as i,L as c,P as h,S as x}from"./vue-CXALzJrr.js";const ee={class:"card page-box",style:{padding:"10px"}},te={class:"pagination",style:{margin:"5px 5px 0"}},le={class:"title"},ae={style:{"text-align":"center"}},oe={__name:"Interface",setup(ne){const D=O(),s=Q();let d=k(!1),w=k("添加接口"),n=P({name:"",url:"",method:"GET",project:s.proList.id,username:D.userInfo.username});function L(){w.value="添加接口",d.value=!0,n.name="",n.url="",n.method="GET"}async function S(){const r=await E.interfaceApi.createInterface(n);r.status===201?(y({title:"接口添加成功！",type:"success",duration:1500}),d.value=!1,await s.getInterFaceList()):y({title:"接口添加失败！",message:r.data.detail,type:"error",duration:1500})}const F=P({name:[{required:!0,message:"接口名称不能为空！",trigger:"blur"},{max:20,message:"接口名称长度不超过20个字符！",trigger:"blur"}],url:[{required:!0,message:"接口地址不能为空！",trigger:"blur"},{max:255,message:"接口地址长度不超过255个字符！",trigger:"blur"}],method:[{required:!0,message:"请求方法不能为空！",trigger:"blur"}]}),T=k();let I=null;function z(r){w.value="编辑接口",d.value=!0,n.name=r.name,n.url=r.url,n.method=r.method,n.username=r.username,I=r.id}async function A(){const r=await E.interfaceApi.updateInterface(I,n);r.status===200&&r.data.code!==300?(d.value=!1,y({title:"接口修改成功！",type:"success",duration:1500}),await s.getInterFaceList()):y({title:"接口修改失败！",message:r.data.detail,type:"error",duration:1500})}function B(r){J.confirm("此操作不可恢复，请确认是否要删除该接口?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",center:!0}).then(async()=>{const e=await E.interfaceApi.deleteInterface(r);e.status===204?(y({title:"接口删除成功！",type:"success",duration:1500}),await s.getInterFaceList()):y({title:"接口删除失败！",message:e.data.detail,type:"error",duration:1500})}).catch(()=>{K({type:"info",message:"已取消删除接口操作。",duration:1500})})}return X(()=>{s.getInterFaceList()}),(r,e)=>{const f=u("el-button"),p=u("el-table-column"),_=u("el-tag"),G=u("el-tooltip"),R=u("el-table"),$=u("el-pagination"),C=u("el-input"),v=u("el-form-item"),b=u("el-option"),N=u("el-select"),j=u("el-form"),q=u("el-drawer");return m(),Y(Z,null,[g("div",ee,[l(f,{onClick:L,size:"small",type:"primary",plain:"",icon:"CirclePlus"},{default:a(()=>[...e[12]||(e[12]=[i("接口",-1)])]),_:1}),l(f,{plain:"",onClick:o(s).getInterFaceList,type:"success",icon:"Refresh",size:"small"},{default:a(()=>[...e[13]||(e[13]=[i("刷新",-1)])]),_:1},8,["onClick"]),l(R,{data:o(s).interfaces,style:{width:"100%"},stripe:"","header-cell-style":{"text-align":"center"},"cell-style":{"text-align":"center"}},{empty:a(()=>[...e[14]||(e[14]=[g("div",{class:"table-empty"},[g("img",{src:M,alt:"notData"}),g("div",null,"暂无数据")],-1)])]),default:a(()=>[l(p,{label:"序号",type:"index",width:"90"}),l(p,{prop:"project",label:"项目名称",width:"100"}),l(p,{prop:"name","show-overflow-tooltip":"","min-width":"150",label:"接口名称"}),l(p,{"show-overflow-tooltip":"",prop:"url",label:"接口地址","min-width":"250"}),l(p,{prop:"method",label:"请求方法",width:"100"},{default:a(t=>[t.row.method==="GET"?(m(),c(_,{key:0,type:"info"},{default:a(()=>[...e[15]||(e[15]=[i("GET",-1)])]),_:1})):t.row.method==="POST"?(m(),c(_,{key:1,type:"success"},{default:a(()=>[...e[16]||(e[16]=[i("POST",-1)])]),_:1})):t.row.method==="PATCH"?(m(),c(_,{key:2,type:"warning"},{default:a(()=>[...e[17]||(e[17]=[i("PATCH",-1)])]),_:1})):t.row.method==="PUT"?(m(),c(_,{key:3,type:"primary"},{default:a(()=>[...e[18]||(e[18]=[i("PUT",-1)])]),_:1})):t.row.method==="DELETE"?(m(),c(_,{key:4,type:"danger"},{default:a(()=>[...e[19]||(e[19]=[i("DELETE",-1)])]),_:1})):h("",!0)]),_:1}),l(p,{prop:"username",label:"创建人",width:"80"}),l(p,{prop:"create_time",label:"创建时间","min-width":"120"},{default:a(t=>[i(x(o(V).rTime(t.row.create_time)),1)]),_:1}),l(p,{label:"更新时间","min-width":"120"},{default:a(t=>[i(x(o(V).rTime(t.row.update_time)),1)]),_:1}),l(p,{label:"操作",width:"200"},{default:a(t=>[l(f,{onClick:H=>z(t.row),icon:"Edit",type:"primary",plain:""},{default:a(()=>[...e[20]||(e[20]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(G,{class:"box-item",effect:"dark",content:"删除测试接口，将删除该接口下的所有用例",placement:"top"},{default:a(()=>[l(f,{onClick:H=>B(t.row.id),icon:"Delete",type:"danger",plain:""},{default:a(()=>[...e[21]||(e[21]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),g("div",te,[l($,{"current-page":o(s).pageConfig.page,"onUpdate:currentPage":e[0]||(e[0]=t=>o(s).pageConfig.page=t),"page-size":o(s).pageConfig.size,"onUpdate:pageSize":e[1]||(e[1]=t=>o(s).pageConfig.size=t),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper",total:o(s).pageConfig.count,onCurrentChange:e[2]||(e[2]=t=>o(s).getInterFaceList()),onSizeChange:e[3]||(e[3]=t=>o(s).getInterFaceList())},null,8,["current-page","page-size","total"])])]),l(q,{modelValue:o(d),"onUpdate:modelValue":e[11]||(e[11]=t=>U(d)?d.value=t:d=t),"with-header":!1},{footer:a(()=>[g("div",ae,[o(w)==="添加接口"?(m(),c(f,{key:0,type:"primary",onClick:e[8]||(e[8]=t=>S(T.value)),plain:""},{default:a(()=>[...e[22]||(e[22]=[i("确定",-1)])]),_:1})):(m(),c(f,{key:1,type:"primary",onClick:e[9]||(e[9]=t=>A(T.value)),plain:""},{default:a(()=>[...e[23]||(e[23]=[i("确定",-1)])]),_:1})),l(f,{onClick:e[10]||(e[10]=t=>U(d)?d.value=!1:d=!1),plain:""},{default:a(()=>[...e[24]||(e[24]=[i("取消",-1)])]),_:1})])]),default:a(()=>[g("div",le,x(o(w)),1),l(j,{model:o(n),rules:F,ref_key:"formDataRef",ref:T,"label-width":"auto"},{default:a(()=>[l(v,{label:"接口名称：",prop:"name"},{default:a(()=>[l(C,{modelValue:o(n).name,"onUpdate:modelValue":e[4]||(e[4]=t=>o(n).name=t),autocomplete:"off",placeholder:"请输入接口名称",clearable:""},null,8,["modelValue"])]),_:1}),l(v,{label:"接口地址：",prop:"url"},{default:a(()=>[l(C,{modelValue:o(n).url,"onUpdate:modelValue":e[5]||(e[5]=t=>o(n).url=t),autocomplete:"off",placeholder:"请输入接口地址",clearable:""},null,8,["modelValue"])]),_:1}),l(v,{label:"请求方法：",prop:"method"},{default:a(()=>[l(N,{style:{width:"100%"},modelValue:o(n).method,"onUpdate:modelValue":e[6]||(e[6]=t=>o(n).method=t),clearable:""},{default:a(()=>[l(b,{label:"GET",value:"GET"}),l(b,{label:"POST",value:"POST"}),l(b,{label:"PUT",value:"PUT"}),l(b,{label:"PATCH",value:"PATCH"}),l(b,{label:"DELETE",value:"DELETE"})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"创建人：",prop:"username"},{default:a(()=>[l(C,{modelValue:o(n).username,"onUpdate:modelValue":e[7]||(e[7]=t=>o(n).username=t),autocomplete:"off",placeholder:"请输入接口创建人",disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}},me=W(oe,[["__scopeId","data-v-eb3ed384"]]);export{me as default};
