import{a as V,v as h,D as u,E as o,F as c,P as C,U as a,O as N,V as S,M as l,ao as d,T as f,a8 as b,S as n,R as m,u as J,L as p}from"./vue-CXALzJrr.js";import{_ as K}from"./Editor-CMLAlzEc.js";import{h as Q,E as q}from"./index-Bqsb1G-Q.js";import{P as W}from"./ProStore-981bTmq_.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"result"},Z={style:{"overflow-x":"auto"}},ee={key:0,style:{color:"#1ab43a"}},le={key:1,style:{color:"#f4b806"}},te={key:0,style:{color:"#1ab43a"}},ae={key:1,style:{color:"#f4b806"}},oe={key:0,style:{"margin-top":"10px",width:"100%","text-align":"center"}},se={class:"dialog-footer"},ue={key:1,class:"button"},ne={__name:"Result",props:{result:{},hideBtn:!1},emits:["close"],setup(s,{emit:E}){const F=V([{id:"3",name:"轻微"},{id:"2",name:"一般"},{id:"1",name:"严重"}]),$=V([{id:"1",name:"未处理"},{id:"2",name:"处理中"},{id:"3",name:"处理完"},{id:"4",name:"无效的"}]),j=s,D=W(),L=D.interfaces,_=V(!1),r=h({interface:null,level:null,describe:"",info:"",status:"1"}),P=h({interface:[{required:!0,message:"所属接口不能为空！",trigger:"blur"}],level:[{required:!0,message:"bug等级不能为空！",trigger:"blur"}],describe:[{required:!0,message:"bug描述不能为空！",trigger:"blur"},{max:255,message:"bug描述不能超过255个字符！",trigger:"blur"}]}),R=V();async function I(U){U.validate(async function(t){if(!t)return;r.project=D.proList.id,r.info=j.result;const i=await Q.bugApi.createBug(r);i.status===201?(q({type:"success",title:"bug提交成功！",duration:1500}),_.value=!1):q({title:"bug提交失败！",type:"error",message:i.data.detail,duration:1500})})}const O=E;function T(){O("close")}return(U,t)=>{const i=d("el-tab-pane"),g=d("el-tag"),k=d("el-collapse-item"),z=d("el-collapse"),A=d("el-tabs"),v=d("el-button"),w=d("el-option"),x=d("el-select"),y=d("el-form-item"),G=d("el-input"),M=d("el-form"),H=d("el-dialog");return o(),u(f,null,[c("div",Y,[N(a(A,{type:"border-card",class:"demo-tabs"},{default:l(()=>[a(i,{label:"响应体"},{default:l(()=>[a(K,{lang:"json",modelValue:s.result.response_body,"onUpdate:modelValue":t[0]||(t[0]=e=>s.result.response_body=e)},null,8,["modelValue"])]),_:1}),a(i,{label:"响应头"},{default:l(()=>[(o(!0),u(f,null,b(s.result.response_header,(e,B)=>(o(),u("div",null,[a(g,{type:"info"},{default:l(()=>[c("b",null,n(B)+"："+n(e),1)]),_:2},1024)]))),256))]),_:1}),a(i,{label:"请求信息"},{default:l(()=>[a(z,null,{default:l(()=>[a(k,{title:"请求",name:"1"},{default:l(()=>[c("div",null,"请求方法："+n(s.result.method),1),c("div",null,"请求地址："+n(s.result.url),1)]),_:1}),a(k,{title:"请求头",name:"2"},{default:l(()=>[(o(!0),u(f,null,b(s.result.requests_header,(e,B)=>(o(),u("div",null,n(B)+"："+n(e),1))),256))]),_:1}),a(k,{title:"请求参数",name:"3"},{default:l(()=>[m(n(s.result.requests_body),1)]),_:1})]),_:1})]),_:1}),a(i,{label:"日志"},{default:l(()=>[c("div",Z,[(o(!0),u(f,null,b(s.result.log_data,e=>(o(),u("div",null,[e[0]==="INFO"?(o(),p(g,{key:0,type:"info"},{default:l(()=>[m(n(e[1]),1)]),_:2},1024)):e[0]==="DEBUG"?(o(),p(g,{key:1,type:"success"},{default:l(()=>[m(n(e[1]),1)]),_:2},1024)):(o(),p(g,{key:2,type:"danger"},{default:l(()=>[m(n(e[1]),1)]),_:2},1024))]))),256))])]),_:1}),a(i,{disabled:""},{label:l(()=>[s.result.state==="成功"?(o(),u("span",ee,"断言："+n(s.result.state),1)):(o(),u("span",le,"断言："+n(s.result.state),1))]),_:1}),a(i,{disabled:""},{label:l(()=>[s.result.status_code<300?(o(),u("span",te,"状态码："+n(s.result.status_code),1)):(o(),u("span",ae,"状态码："+n(s.result.status_code),1))]),_:1}),a(i,{disabled:""},{label:l(()=>[m(" 耗时："+n(s.result.run_time),1)]),_:1})]),_:1},512),[[S,s.result.name]])]),s.result.state==="失败"?(o(),u("div",oe,[N(a(v,{onClick:t[1]||(t[1]=e=>_.value=!0),plain:"",type:"danger"},{default:l(()=>[...t[9]||(t[9]=[m("提交bug",-1)])]),_:1},512),[[S,!s.hideBtn]])])):C("",!0),a(H,{title:"提交bug",modelValue:_.value,"onUpdate:modelValue":t[8]||(t[8]=e=>_.value=e),width:"40%",center:""},{footer:l(()=>[c("div",se,[a(v,{type:"primary",plain:"",onClick:t[6]||(t[6]=e=>I(R.value))},{default:l(()=>[...t[10]||(t[10]=[m("确定",-1)])]),_:1}),a(v,{onClick:t[7]||(t[7]=e=>_.value=!1),plain:""},{default:l(()=>[...t[11]||(t[11]=[m("取消",-1)])]),_:1})])]),default:l(()=>[a(M,{model:r,rules:P,ref_key:"formDataRef",ref:R,"label-width":"auto"},{default:l(()=>[a(y,{label:"所属接口：",prop:"interface"},{default:l(()=>[a(x,{modelValue:r.interface,"onUpdate:modelValue":t[2]||(t[2]=e=>r.interface=e),placeholder:"请选择bug对应的接口",style:{width:"100%"},clearable:"","fit-input-width":!0},{default:l(()=>[(o(!0),u(f,null,b(J(L),e=>(o(),p(w,{label:e.name+"："+e.url,value:e.id,key:e.id,title:e.name+"："+e.url},null,8,["label","value","title"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"bug状态：",prop:"status"},{default:l(()=>[a(x,{modelValue:r.status,"onUpdate:modelValue":t[3]||(t[3]=e=>r.status=e),placeholder:"请选择bug状态",style:{width:"100%"},disabled:""},{default:l(()=>[(o(!0),u(f,null,b($.value,e=>(o(),p(w,{label:e.name,value:e.id,key:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"bug等级：",prop:"level"},{default:l(()=>[a(x,{modelValue:r.level,"onUpdate:modelValue":t[4]||(t[4]=e=>r.level=e),placeholder:"请选择bug等级",style:{width:"100%"},clearable:""},{default:l(()=>[(o(!0),u(f,null,b(F.value,e=>(o(),p(w,{label:e.name,value:e.id,key:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"bug描述：",prop:"describe"},{default:l(()=>[a(G,{autosize:{minRows:3,maxRows:4},modelValue:r.describe,"onUpdate:modelValue":t[5]||(t[5]=e=>r.describe=e),type:"textarea",autocomplete:"off",placeholder:"请输入bug的描述信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),s.hideBtn?C("",!0):(o(),u("div",ue,[a(v,{type:"primary",onClick:T,plain:""},{default:l(()=>[...t[12]||(t[12]=[m("确定",-1)])]),_:1})]))],64)}}},ce=X(ne,[["__scopeId","data-v-8294bb7a"]]);export{ce as R};
