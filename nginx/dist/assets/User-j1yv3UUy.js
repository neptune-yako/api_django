import{_ as re}from"./none-CwC0Lq_I.js";import{h as U,a as oe,E as c,b as ie}from"./index-Bqsb1G-Q.js";import{t as M}from"./dateTools-APCdG_Ih.js";import{a as y,v as C,o as ue,D as z,F as x,U as a,O as ne,M as t,au as de,L as f,q as B,u as s,T,ao as m,E as n,R as u,P as S,a8 as j,S as $,Q as J}from"./vue-CXALzJrr.js";const pe={class:"card page_box",style:{padding:"10px"}},me={key:1},fe={class:"pagination",style:{margin:"5px 5px 0"}},ge={style:{"text-align":"center"}},be={style:{"text-align":"center"}},ke={__name:"User",setup(_e){const O=y([]),A=y([]),D=y(!1),q=y(!1);let o=C({id:0,username:"",email:"",nickname:"",password:"",check_password:"",mobile:"",is_superuser:!1,is_active:!0,is_staff:!1,role:[]}),r=C({id:0,username:"",email:"",nickname:"",mobile:"",is_active:!0,is_superuser:"",is_staff:"",role:[]});ue(()=>{le(),w()});const v=C({page:1,size:10,count:0}),N=y(!1);async function w(){N.value=!0;const i={page:v.page,size:v.size},e=await U.userApi.getUser(i);e.status===200&&(O.value=e.data.results,v.count=e.data.count,N.value=!1)}const K=C({username:[{required:!0,message:"请输入登录名",trigger:"blur"},{max:20,message:"登录名不得超过20个字符",trigger:"blur"}],nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"},{max:20,message:"用户昵称不得超过20个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{max:128,message:"密码不得超过128个字符",trigger:"blur"}],check_password:[{required:!0,message:"请输入确认密码",trigger:"blur"},{max:128,message:"密码不得超过128个字符",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{max:11,message:"手机号不得超过11个字符",trigger:"blur"}],email:[{required:!0,message:"请输入用户邮箱",trigger:"blur"},{max:50,message:"用户邮箱不得超过50个字符",trigger:"blur"}]});let b=y(!1);const P=y();function W(){b.value=!0}async function X(){if(!await P.value.validate().catch(()=>!1))return;const e=await U.userApi.register({...o,role_ids:o.role});e.status===200?(c({type:"success",title:"已成功新建用户！",duration:1500,message:`用户账号为：${o.username}`}),await w(),b.value=!1):c({type:"error",title:"新建用户失败！",duration:1500,message:e.data.detail})}let _=y(!1);function Y(i){_.value=!0,r.id=i.id,r.username=i.username,r.email=i.email,r.nickname=i.nickname,r.mobile=i.mobile,r.is_active=i.is_active,r.is_superuser=i.is_superuser,r.is_staff=i.is_staff,r.role=i.roles?i.roles.map(e=>e.id):[]}const Z=C({username:[{required:!0,message:"请输入登录名",trigger:"blur"},{max:20,message:"登录名不得超过20个字符",trigger:"blur"}],email:[{required:!0,message:"请输入用户邮箱",trigger:"blur"},{max:50,message:"用户邮箱不得超过50个字符",trigger:"blur"}],nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"},{max:20,message:"用户昵称不得超过20个字符",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{max:11,message:"手机号不得超过11个字符",trigger:"blur"}]}),L=y();async function h(){if(!await L.value.validate().catch(()=>!1))return;const e=await U.userApi.updateUser(r.id,{...r,role_ids:r.role});e.status===200?(c({type:"success",title:"已成功修改用户！",duration:1500}),await w(),_.value=!1):c({title:"用户修改失败！",message:e.data.detail,type:"error",duration:1500})}async function ee(i){oe.confirm("此操作不可恢复，确认删除该用户吗？","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",center:!0}).then(async()=>{const e=await U.userApi.deleteUser(i);e.status===204?(await w(),c({type:"success",title:"用户删除成功！",duration:1500})):c({title:"用户删除失败！",message:e.data.detail,type:"error",duration:1500})}).catch(()=>{ie({type:"info",message:"已取消删除操作。",duration:1500})})}async function le(){const i=await U.roleApi.getRole();i.status===200&&(A.value=i.data.results)}return(i,e)=>{const V=m("el-button"),p=m("el-table-column"),k=m("el-tag"),ae=m("el-table"),te=m("el-pagination"),g=m("el-input"),d=m("el-form-item"),F=m("el-icon"),H=m("el-option"),Q=m("el-select"),R=m("el-switch"),G=m("el-form"),I=m("el-dialog"),se=de("loading");return n(),z(T,null,[x("div",pe,[a(V,{plain:"",onClick:W,type:"primary",icon:"CirclePlus",size:"small"},{default:t(()=>[...e[26]||(e[26]=[u("用户",-1)])]),_:1}),a(V,{plain:"",onClick:w,type:"success",icon:"Refresh",size:"small"},{default:t(()=>[...e[27]||(e[27]=[u("刷新",-1)])]),_:1}),ne((n(),f(ae,{data:O.value,style:{width:"100%"},stripe:"","header-cell-style":{"text-align":"center"},"cell-style":{"text-align":"center"},"element-loading-text":"加载中..."},{empty:t(()=>[...e[28]||(e[28]=[x("div",{class:"table-empty"},[x("img",{src:re,alt:"notData"}),x("div",null,"暂无数据")],-1)])]),default:t(()=>[a(p,{label:"序号",type:"index",width:"90"}),a(p,{prop:"username",label:"登录名"}),a(p,{prop:"nickname",label:"用户昵称"}),a(p,{prop:"email",label:"用户邮箱","min-width":"130"}),a(p,{prop:"mobile",label:"手机号","min-width":"100"}),a(p,{prop:"is_superuser",label:"管理员",width:"100px"},{default:t(l=>[l.row.is_superuser===!0?(n(),f(k,{key:0,type:"primary"},{default:t(()=>[...e[29]||(e[29]=[u("是",-1)])]),_:1})):l.row.is_superuser===!1?(n(),f(k,{key:1,type:"info"},{default:t(()=>[...e[30]||(e[30]=[u("否",-1)])]),_:1})):S("",!0)]),_:1}),a(p,{prop:"is_staff",label:"后台权限",width:"100px"},{default:t(l=>[l.row.is_staff===!0?(n(),f(k,{key:0,type:"primary"},{default:t(()=>[...e[31]||(e[31]=[u("是",-1)])]),_:1})):l.row.is_staff===!1?(n(),f(k,{key:1,type:"info"},{default:t(()=>[...e[32]||(e[32]=[u("否",-1)])]),_:1})):S("",!0)]),_:1}),a(p,{label:"关联角色",width:"150"},{default:t(l=>[l.row.roles.length?(n(!0),z(T,{key:0},j(l.row.roles,E=>(n(),f(k,{key:E.id,type:"primary"},{default:t(()=>[u($(E.name),1)]),_:2},1024))),128)):(n(),z("span",me,"-"))]),_:1}),a(p,{label:"状态",width:"80px"},{default:t(l=>[l.row.is_active===!0?(n(),f(k,{key:0,type:"primary"},{default:t(()=>[...e[33]||(e[33]=[u("启用",-1)])]),_:1})):l.row.is_active===!1?(n(),f(k,{key:1,type:"danger"},{default:t(()=>[...e[34]||(e[34]=[u("禁用",-1)])]),_:1})):S("",!0)]),_:1}),a(p,{prop:"last_login",label:"最后登录时间","min-width":"120"},{default:t(l=>[u($(l.row.last_login?s(M).rTime(l.row.last_login):"-"),1)]),_:1}),a(p,{prop:"date_joined",label:"创建时间","min-width":"120"},{default:t(l=>[u($(s(M).rTime(l.row.date_joined)),1)]),_:1}),a(p,{label:"更新时间","min-width":"120"},{default:t(l=>[u($(s(M).rTime(l.row.update_time)),1)]),_:1}),a(p,{label:"操作",width:"200"},{default:t(l=>[a(V,{type:"primary",icon:"Edit",onClick:E=>Y(l.row),plain:""},{default:t(()=>[...e[35]||(e[35]=[u("编辑",-1)])]),_:1},8,["onClick"]),a(V,{onClick:E=>ee(l.row.id),icon:"Delete",type:"danger",plain:""},{default:t(()=>[...e[36]||(e[36]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,N.value]]),x("div",fe,[a(te,{"current-page":v.page,"onUpdate:currentPage":e[0]||(e[0]=l=>v.page=l),"page-size":v.size,"onUpdate:pageSize":e[1]||(e[1]=l=>v.size=l),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper",total:v.count,onCurrentChange:w,onSizeChange:w},null,8,["current-page","page-size","total"])])]),a(I,{modelValue:s(b),"onUpdate:modelValue":e[15]||(e[15]=l=>B(b)?b.value=l:b=l),title:"添加用户",width:"600",center:""},{default:t(()=>[a(G,{model:s(o),rules:K,ref_key:"formDataRef",ref:P,"label-width":"auto"},{default:t(()=>[a(d,{label:"登录名：",prop:"username"},{default:t(()=>[a(g,{modelValue:s(o).username,"onUpdate:modelValue":e[2]||(e[2]=l=>s(o).username=l),placeholder:"请输入登录名",clearable:""},null,8,["modelValue"])]),_:1}),a(d,{label:"用户昵称：",prop:"nickname"},{default:t(()=>[a(g,{modelValue:s(o).nickname,"onUpdate:modelValue":e[3]||(e[3]=l=>s(o).nickname=l),placeholder:"请输入用户昵称",clearable:""},null,8,["modelValue"])]),_:1}),a(d,{label:"登录密码：",prop:"password"},{default:t(()=>[a(g,{modelValue:s(o).password,"onUpdate:modelValue":e[5]||(e[5]=l=>s(o).password=l),type:D.value?"text":"password",placeholder:"请输入登录密码",clearable:""},{suffix:t(()=>[a(F,{onClick:e[4]||(e[4]=l=>D.value=!D.value),style:{cursor:"pointer"}},{default:t(()=>[(n(),f(J(D.value?"View":"Hide")))]),_:1})]),_:1},8,["modelValue","type"])]),_:1}),a(d,{label:"确认密码：",prop:"check_password"},{default:t(()=>[a(g,{modelValue:s(o).check_password,"onUpdate:modelValue":e[7]||(e[7]=l=>s(o).check_password=l),type:q.value?"text":"password",placeholder:"请输入确认密码",clearable:""},{suffix:t(()=>[a(F,{onClick:e[6]||(e[6]=l=>q.value=!q.value),style:{cursor:"pointer"}},{default:t(()=>[(n(),f(J(q.value?"View":"Hide")))]),_:1})]),_:1},8,["modelValue","type"])]),_:1}),a(d,{label:"用户邮箱：",prop:"email"},{default:t(()=>[a(g,{modelValue:s(o).email,"onUpdate:modelValue":e[8]||(e[8]=l=>s(o).email=l),placeholder:"请输入用户邮箱",clearable:""},null,8,["modelValue"])]),_:1}),a(d,{label:"手机号：",prop:"mobile"},{default:t(()=>[a(g,{modelValue:s(o).mobile,"onUpdate:modelValue":e[9]||(e[9]=l=>s(o).mobile=l),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1}),a(d,{label:"关联角色：",prop:"role"},{default:t(()=>[a(Q,{modelValue:s(o).role,"onUpdate:modelValue":e[10]||(e[10]=l=>s(o).role=l),multiple:"",placeholder:"请选择角色"},{default:t(()=>[(n(!0),z(T,null,j(A.value,l=>(n(),f(H,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"是否管理员：",prop:"is_superuser"},{default:t(()=>[a(R,{modelValue:s(o).is_superuser,"onUpdate:modelValue":e[11]||(e[11]=l=>s(o).is_superuser=l)},null,8,["modelValue"])]),_:1}),a(d,{label:"后台权限：",prop:"is_staff"},{default:t(()=>[a(R,{modelValue:s(o).is_staff,"onUpdate:modelValue":e[12]||(e[12]=l=>s(o).is_staff=l)},null,8,["modelValue"])]),_:1}),x("div",ge,[a(V,{type:"primary",onClick:e[13]||(e[13]=l=>X(P.value)),plain:""},{default:t(()=>[...e[37]||(e[37]=[u("保存",-1)])]),_:1}),a(V,{onClick:e[14]||(e[14]=l=>B(b)?b.value=!1:b=!1),plain:""},{default:t(()=>[...e[38]||(e[38]=[u("取消",-1)])]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a(I,{modelValue:s(_),"onUpdate:modelValue":e[25]||(e[25]=l=>B(_)?_.value=l:_=l),title:"编辑用户",width:"600",center:""},{default:t(()=>[a(G,{model:s(r),rules:Z,ref_key:"formUpdateRef",ref:L,"label-width":"auto"},{default:t(()=>[a(d,{label:"登录名：",prop:"username"},{default:t(()=>[a(g,{modelValue:s(r).username,"onUpdate:modelValue":e[16]||(e[16]=l=>s(r).username=l),placeholder:"请输入登录名",clearable:""},null,8,["modelValue"])]),_:1}),a(d,{label:"用户昵称：",prop:"nickname"},{default:t(()=>[a(g,{modelValue:s(r).nickname,"onUpdate:modelValue":e[17]||(e[17]=l=>s(r).nickname=l),placeholder:"请输入用户昵称",clearable:""},null,8,["modelValue"])]),_:1}),a(d,{label:"用户邮箱：",prop:"email"},{default:t(()=>[a(g,{modelValue:s(r).email,"onUpdate:modelValue":e[18]||(e[18]=l=>s(r).email=l),placeholder:"请输入用户邮箱",clearable:""},null,8,["modelValue"])]),_:1}),a(d,{label:"手机号：",prop:"mobile"},{default:t(()=>[a(g,{modelValue:s(r).mobile,"onUpdate:modelValue":e[19]||(e[19]=l=>s(r).mobile=l),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1}),a(d,{label:"关联角色：",prop:"role"},{default:t(()=>[a(Q,{modelValue:s(r).role,"onUpdate:modelValue":e[20]||(e[20]=l=>s(r).role=l),multiple:"",placeholder:"请选择角色"},{default:t(()=>[(n(!0),z(T,null,j(A.value,l=>(n(),f(H,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"是否管理员：",prop:"is_superuser"},{default:t(()=>[a(R,{modelValue:s(r).is_superuser,"onUpdate:modelValue":e[21]||(e[21]=l=>s(r).is_superuser=l)},null,8,["modelValue"])]),_:1}),a(d,{label:"后台权限：",prop:"is_staff"},{default:t(()=>[a(R,{modelValue:s(r).is_staff,"onUpdate:modelValue":e[22]||(e[22]=l=>s(r).is_staff=l)},null,8,["modelValue"])]),_:1}),x("div",be,[a(V,{type:"primary",onClick:e[23]||(e[23]=l=>h(L.value)),plain:""},{default:t(()=>[...e[39]||(e[39]=[u("保存",-1)])]),_:1}),a(V,{onClick:e[24]||(e[24]=l=>B(_)?_.value=!1:_=!1),plain:""},{default:t(()=>[...e[40]||(e[40]=[u("取消",-1)])]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}};export{ke as default};
