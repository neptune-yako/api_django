import{_ as K}from"./none-CwC0Lq_I.js";import{P as Q}from"./ProStore-981bTmq_.js";import{U as W,h as g,E as m,a as X,b as Y}from"./index-Bqsb1G-Q.js";import{t as S}from"./dateTools-APCdG_Ih.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{v as V,a as h,D as y,F as a,U as o,O as ee,M as n,au as te,L as _,T as z,ao as d,E as u,R as s,S as E,u as w,a8 as A}from"./vue-CXALzJrr.js";const oe={class:"card page-box",style:{padding:"10px"}},ae={class:"pagination",style:{margin:"5px 5px 0"}},le={class:"title"},ne={key:0},se={key:1},re={slot:"footer",class:"dialog-footer",style:{"text-align":"center"}},ie={__name:"Cronjob",setup(de){const T=W(),v=Q(),l=V({cronjobList:null,dialogCronjob:!1,updateBtn:!0,cronjobData:{name:"定时任务",rule:"*/1 * * * *",status:!1,plan:null,env:null,username:T.userInfo.username}}),c=V({page:1,size:10,count:0}),C=h(!1);async function f(){C.value=!0;const r={page:c.page,size:c.size},e=await g.cronjobApi.getCronjob(v.proList.id,r);e.status===200&&(l.cronjobList=e.data.results,c.count=e.data.count,C.value=!1)}f();async function $(r){const e=await g.cronjobApi.updateCronjob(r.id,r);e.status===200&&e.data.code!==300?r.status===!0?(m({type:"success",title:"定时任务已开启！",duration:1500}),await f()):m({type:"warning",title:"定时任务已关闭！",duration:1500}):m({title:"定时任务开启失败！",type:"error",message:e.data.detail,duration:1500})}function R(r){X.confirm("此操作不可恢复，确认要删除该任务?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",center:!0}).then(async()=>{const e=await g.cronjobApi.deleteCronjob(r);e.status===204?(m({type:"success",title:"定时任务删除成功！",duration:1500}),await f()):m({title:"定时任务删除失败！",type:"error",message:e.data.detail,duration:1500})}).catch(()=>{Y({type:"info",message:"已取消删除定时任务。",duration:1500})})}function q(){l.dialogCronjob=!0,l.updateBtn=!1}const N=V({name:[{required:!0,message:"定时任务名称不能为空！",trigger:"blur"},{max:20,message:"定时任务名称长度b不超过20个字符！",trigger:"blur"}],env:[{required:!0,message:"测试环境不能为空！",trigger:"blur"}],rule:[{required:!0,message:"定时规则不能为空！",trigger:"blur"}],plan:[{required:!0,message:"执行计划不能为空！",trigger:"blur"}]}),x=h();async function P(r){r.validate(async function(e){if(!e)return;const p={project:v.proList.id,...l.cronjobData},i=await g.cronjobApi.createCronjob(p);i.status===200&&i.data.code!==300?(m({type:"success",title:"定时任务添加成功！",duration:1500}),l.dialogCronjob=!1,await f()):m({title:"定时任务添加失败！",message:i.data.detail,type:"error",duration:1500})})}function M(r){l.cronjobData={...r},l.dialogCronjob=!0,l.updateBtn=!0}async function F(){const r=await g.cronjobApi.updateCronjob(l.cronjobData.id,l.cronjobData);r.status===200&&r.data.code!==300?(m({type:"success",title:"定时任务修改成功！",duration:1500}),l.dialogCronjob=!1,await f()):m({title:"定时任务修改失败！",message:r.data.detail,type:"error",duration:1500})}return(r,e)=>{const p=d("el-button"),i=d("el-table-column"),k=d("el-switch"),I=d("el-table"),O=d("el-pagination"),D=d("el-input"),b=d("el-form-item"),U=d("el-option"),B=d("el-select"),L=d("el-col"),G=d("el-form"),H=d("el-drawer"),J=te("loading");return u(),y(z,null,[a("div",oe,[o(p,{plain:"",onClick:q,type:"primary",icon:"CirclePlus",size:"small"},{default:n(()=>[...e[12]||(e[12]=[s("任务",-1)])]),_:1}),o(p,{plain:"",onClick:f,type:"success",icon:"Refresh",size:"small"},{default:n(()=>[...e[13]||(e[13]=[s("刷新",-1)])]),_:1}),ee((u(),_(I,{data:l.cronjobList,style:{width:"100%"},stripe:"","header-cell-style":{"text-align":"center"},"cell-style":{"text-align":"center"},"element-loading-text":"加载中..."},{empty:n(()=>[...e[14]||(e[14]=[a("div",{class:"table-empty"},[a("img",{src:K,alt:"notData"}),a("div",null,"暂无数据")],-1)])]),default:n(()=>[o(i,{label:"序号",type:"index",width:"90"}),o(i,{prop:"name",label:"任务名称","min-width":"140"}),o(i,{prop:"pro_name",label:"项目名称","min-width":"140"}),o(i,{prop:"plan_name",label:"计划名称","min-width":"140"}),o(i,{prop:"env_name",label:"环境名称","min-width":"140"}),o(i,{prop:"username",label:"创建人",width:"80"}),o(i,{prop:"rule",label:"定时规则","min-width":"140"}),o(i,{label:"创建时间","min-width":"180"},{default:n(t=>[s(E(w(S).rTime(t.row.create_time)),1)]),_:1}),o(i,{label:"更新时间","min-width":"180"},{default:n(t=>[s(E(w(S).rTime(t.row.update_time)),1)]),_:1}),o(i,{label:"状态"},{default:n(t=>[o(k,{onChange:j=>$(t.row),modelValue:t.row.status,"onUpdate:modelValue":j=>t.row.status=j,"active-color":"#13ce66","inactive-color":"#b1b1b1"},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:1}),o(i,{label:"操作","min-width":"180"},{default:n(t=>[o(p,{onClick:j=>M(t.row),type:"primary",plain:"",icon:"Edit"},{default:n(()=>[...e[15]||(e[15]=[s("编辑",-1)])]),_:1},8,["onClick"]),o(p,{onClick:j=>R(t.row.id),type:"danger",plain:"",icon:"Delete"},{default:n(()=>[...e[16]||(e[16]=[s("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,C.value]]),a("div",ae,[o(O,{"current-page":c.page,"onUpdate:currentPage":e[0]||(e[0]=t=>c.page=t),"page-size":c.size,"onUpdate:pageSize":e[1]||(e[1]=t=>c.size=t),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper",total:c.count,onCurrentChange:f,onSizeChange:f},null,8,["current-page","page-size","total"])])]),o(H,{modelValue:l.dialogCronjob,"onUpdate:modelValue":e[11]||(e[11]=t=>l.dialogCronjob=t),"with-header":!1,direction:"rtl",width:"50%"},{footer:n(()=>[a("div",re,[l.updateBtn?(u(),_(p,{key:0,type:"primary",onClick:e[8]||(e[8]=t=>F(x.value)),plain:""},{default:n(()=>[...e[19]||(e[19]=[s("确定",-1)])]),_:1})):(u(),_(p,{key:1,type:"primary",onClick:e[9]||(e[9]=t=>P(x.value)),plain:""},{default:n(()=>[...e[20]||(e[20]=[s("确定",-1)])]),_:1})),o(p,{onClick:e[10]||(e[10]=t=>l.dialogCronjob=!1),plain:""},{default:n(()=>[...e[21]||(e[21]=[s("取消",-1)])]),_:1})])]),default:n(()=>[a("div",le,[l.updateBtn?(u(),y("span",ne,"修改定时任务")):(u(),y("span",se,"创建定时任务"))]),o(G,{model:l.cronjobData,rules:N,ref_key:"formDataRef",ref:x,"label-width":"auto"},{default:n(()=>[o(b,{label:"任务名称：",prop:"name"},{default:n(()=>[o(D,{modelValue:l.cronjobData.name,"onUpdate:modelValue":e[2]||(e[2]=t=>l.cronjobData.name=t),placeholder:"请输入任务名称",clearable:""},null,8,["modelValue"])]),_:1}),o(b,{label:"测试环境：",prop:"env"},{default:n(()=>[o(B,{modelValue:l.cronjobData.env,"onUpdate:modelValue":e[3]||(e[3]=t=>l.cronjobData.env=t),placeholder:"请选择测试环境",style:{width:"100%"},clearable:""},{default:n(()=>[(u(!0),y(z,null,A(w(v).envList,t=>(u(),_(U,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(b,{label:"测试计划：",prop:"plan"},{default:n(()=>[o(B,{style:{width:"100%"},modelValue:l.cronjobData.plan,"onUpdate:modelValue":e[4]||(e[4]=t=>l.cronjobData.plan=t),placeholder:"请选择测试计划",clearable:""},{default:n(()=>[(u(!0),y(z,null,A(w(v).planList,t=>(u(),_(U,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(b,{label:"状态："},{default:n(()=>[o(k,{modelValue:l.cronjobData.status,"onUpdate:modelValue":e[5]||(e[5]=t=>l.cronjobData.status=t),"active-color":"#79d0ff","inactive-color":"#c3c3c3",size:"small"},null,8,["modelValue"])]),_:1}),o(b,{label:"创建人：",prop:"username"},{default:n(()=>[o(D,{modelValue:l.cronjobData.username,"onUpdate:modelValue":e[6]||(e[6]=t=>l.cronjobData.username=t),placeholder:"请输入创建人",disabled:""},null,8,["modelValue"])]),_:1}),o(b,{label:"定时规则：",prop:"rule"},{default:n(()=>[o(D,{modelValue:l.cronjobData.rule,"onUpdate:modelValue":e[7]||(e[7]=t=>l.cronjobData.rule=t),placeholder:"请输入定时规则，格式：* * * * *",clearable:""},null,8,["modelValue"]),o(L,{span:24},{default:n(()=>[...e[17]||(e[17]=[a("h4",null,"规则说明：crontab格式，具体参考官网：https://crontab.guru",-1),a("div",{style:{"font-size":"14px"}},[s("* * * * * "),a("span",{style:{color:"#909399"}},"分别表示：minute、hour、day、month、week。")],-1),a("div",{style:{"font-size":"14px"}},[s("minute："),a("span",{style:{color:"#909399"}},"表示分钟，从0到59之间的任何整数。")],-1),a("div",{style:{"font-size":"14px"}},[s("hour："),a("span",{style:{color:"#909399"}},"表示小时，从0到23之间的任何整数。")],-1),a("div",{style:{"font-size":"14px"}},[s("day："),a("span",{style:{color:"#909399"}},"表示日期，从1到31之间的任何整数。")],-1),a("div",{style:{"font-size":"14px"}},[s("month："),a("span",{style:{color:"#909399"}},"表示月份，从1到12之间的任何整数。")],-1),a("div",{style:{"font-size":"14px"}},[s("week："),a("span",{style:{color:"#909399"}},"表示星期几，从0到7之间的任何整数，0或7代表星期日。")],-1)])]),_:1}),o(L,{span:24},{default:n(()=>[...e[18]||(e[18]=[a("h4",null,"配置案例：",-1),a("div",{style:{"font-size":"14px"}},[s("5 * * * * : "),a("span",{style:{color:"#909399"}},"每小时的第5分钟执行一次任务。")],-1),a("div",{style:{"font-size":"14px"}},[s("30 9 * * * : "),a("span",{style:{color:"#909399"}},"每天上午的9:30执行一次任务。")],-1),a("div",{style:{"font-size":"14px"}},[s("30 9 8 * * : "),a("span",{style:{color:"#909399"}},"每月8号上午的9:30执行一次任务。")],-1),a("div",{style:{"font-size":"14px"}},[s("30 9 5 3 * : "),a("span",{style:{color:"#909399"}},"每年的3月5日9:30执行一次任务。")],-1),a("div",{style:{"font-size":"14px"}},[s("30 9 * * sun : "),a("span",{style:{color:"#909399"}},"每星期日的上午9:30执行一次任务。")],-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}},ge=Z(ie,[["__scopeId","data-v-3a526cb8"]]);export{ge as default};
