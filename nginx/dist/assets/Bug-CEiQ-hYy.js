import{_ as ge}from"./none-CwC0Lq_I.js";import{t as V}from"./dateTools-APCdG_Ih.js";import{d as F,c as H}from"./chart-Bt2xmhMA.js";import{u as pe,h as T,a as me,E as R,b as fe}from"./index-Bqsb1G-Q.js";import{P as ve}from"./ProStore-981bTmq_.js";import{R as be}from"./Result-DvMrgyyD.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{v as j,a as S,e as U,o as _e,w as we,D as z,F as g,U as l,M as t,O as Be,au as ke,L as r,u as b,T as J,ao as i,E as o,q as h,R as u,P as A,S as y,a8 as ce}from"./vue-CXALzJrr.js";import"./Editor-CMLAlzEc.js";const xe={class:"card page-box"},Ce={class:"card bug-list",style:{padding:"10px"}},Ie={key:0},ze={key:1},De={class:"pagination",style:{margin:"5px 5px 0"}},Ve={key:0},he={key:1},Ee={style:{"margin-top":"10px"}},$e={style:{"margin-top":"10px"}},Le={style:{"text-align":"center"}},Fe={class:"dialog-footer"},Te={__name:"Bug",setup(Re){const K=ve(),N=pe(),_=j({page:1,size:10,count:0}),n=j({showBug:!1,bugInfo:null,bugLogs:null,updateBugDlg:!1,updateBugForm:{}}),M=S(!1);let m=S([]),d=S([]);async function B(){M.value=!0;const s=await T.bugApi.getBug({project:K.proList.id,page:_.page,size:_.size});s.status===200&&(m.value=s.data.results,_.count=s.data.count,d.value=s.data.results,q(),M.value=!1)}const k=U(()=>m.value.filter(s=>s.status==="1")),c=U(()=>m.value.filter(s=>s.status==="2")),x=U(()=>m.value.filter(s=>s.status==="3")),C=U(()=>m.value.filter(s=>s.status==="4"));function q(){const s=document.getElementById("chart1Box"),e=document.getElementById("chart2Box");if(!s||!e)return;F(s),F(e);const w=[m.value.length,x.value.length,c.value.length,k.value.length,C.value.length],E=["bug的总数","处理完bug","处理中bug","未处理bug","无效的bug"];H.chart1(s,w,E,N.value),H.chart2(e,[{value:x.value.length,name:"处理完bug"},{value:c.value.length,name:"处理中bug"},{value:k.value.length,name:"未处理bug"},{value:C.value.length,name:"无效的bug"}],N.value)}async function Q(s){n.bugInfo=s;const e=await T.bugApi.getBugInfo(s.id);e.status===200&&(n.bugLogs=e.data),n.showBug=!0}const W=j({status:[{required:!0,message:"bug状态不能为空！",trigger:"blur"}]}),O=S();async function X(s){s.validate(async function(e){if(!e)return;const w=await T.bugApi.updateBug(n.updateBugForm.id,n.updateBugForm);w.status===200?(R({type:"success",title:"bug状态修改成功！",duration:1500}),n.updateBugDlg=!1,await B()):R({title:"bug状态修改失败！",type:"error",message:w.data.detail,duration:1500})})}async function Y(s){me.confirm("此操作不可恢复，确认要删除该bug?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",center:!0}).then(async()=>{const e=await T.bugApi.deleteBug(s);e.status===204?(R({type:"success",title:"bug删除成功！",duration:1500}),await B(),d.value=m.value):R({title:"bug删除失败！",type:"error",message:e.data.detail,duration:1500})}).catch(()=>{fe({type:"info",message:"已取消删除bug。",duration:1500})})}return _e(async()=>{await B(),d.value=m.value}),we(N,()=>{F(document.getElementById("chart1Box")),F(document.getElementById("chart2Box")),q()}),(s,e)=>{const w=i("el-col"),E=i("el-row"),f=i("el-button"),I=i("el-badge"),v=i("el-table-column"),p=i("el-tag"),Z=i("el-table"),ee=i("el-pagination"),D=i("el-descriptions-item"),te=i("el-descriptions"),P=i("el-card"),G=i("el-empty"),le=i("el-timeline-item"),ae=i("el-timeline"),ne=i("el-scrollbar"),ue=i("el-drawer"),$=i("el-option"),oe=i("el-select"),se=i("el-form-item"),ie=i("el-form"),re=i("el-dialog"),de=ke("loading");return o(),z(J,null,[g("div",xe,[l(E,{gutter:10},{default:t(()=>[l(w,{span:12},{default:t(()=>[...e[13]||(e[13]=[g("div",{class:"chartBox",id:"chart1Box"},null,-1)])]),_:1}),l(w,{span:12},{default:t(()=>[...e[14]||(e[14]=[g("div",{class:"chartBox",id:"chart2Box"},null,-1)])]),_:1})]),_:1})]),g("div",Ce,[l(E,null,{default:t(()=>[l(I,{value:b(m).length,hidden:b(m).length===0,class:"item",max:99},{default:t(()=>[l(f,{onClick:e[0]||(e[0]=a=>h(d)?d.value=b(m):d=b(m)),type:"primary",plain:"",size:"small"},{default:t(()=>[...e[15]||(e[15]=[u("所有的bug",-1)])]),_:1})]),_:1},8,["value","hidden"]),l(I,{value:k.value.length,hidden:k.value.length===0,class:"item",max:99,style:{margin:"0 10px"}},{default:t(()=>[l(f,{onClick:e[1]||(e[1]=a=>h(d)?d.value=k.value:d=k.value),type:"danger",plain:"",size:"small"},{default:t(()=>[...e[16]||(e[16]=[u("未处理bug",-1)])]),_:1})]),_:1},8,["value","hidden"]),l(I,{value:c.value.length,hidden:c.value.length===0,class:"item",max:99,style:{"margin-right":"10px"}},{default:t(()=>[l(f,{onClick:e[2]||(e[2]=a=>h(d)?d.value=c.value:d=c.value),type:"warning",plain:"",size:"small"},{default:t(()=>[...e[17]||(e[17]=[u("处理中bug",-1)])]),_:1})]),_:1},8,["value","hidden"]),l(I,{value:x.value.length,hidden:x.value.length===0,class:"item",max:99,style:{"margin-right":"10px"}},{default:t(()=>[l(f,{onClick:e[3]||(e[3]=a=>h(d)?d.value=x.value:d=x.value),type:"success",plain:"",size:"small"},{default:t(()=>[...e[18]||(e[18]=[u("处理完bug",-1)])]),_:1})]),_:1},8,["value","hidden"]),l(I,{value:C.value.length,hidden:C.value.length===0,class:"item",max:99,style:{"margin-right":"10px"}},{default:t(()=>[l(f,{onClick:e[4]||(e[4]=a=>h(d)?d.value=C.value:d=C.value),type:"info",plain:"",size:"small"},{default:t(()=>[...e[19]||(e[19]=[u("无效的bug",-1)])]),_:1})]),_:1},8,["value","hidden"]),l(I,null,{default:t(()=>[l(f,{plain:"",onClick:B,type:"success",icon:"Refresh",size:"small"},{default:t(()=>[...e[20]||(e[20]=[u("刷新",-1)])]),_:1})]),_:1})]),_:1}),Be((o(),r(Z,{data:b(d),style:{width:"100%"},stripe:"","header-cell-style":{"text-align":"center"},"cell-style":{"text-align":"center"},"element-loading-text":"加载中..."},{empty:t(()=>[...e[21]||(e[21]=[g("div",{class:"table-empty"},[g("img",{src:ge,alt:"notData"}),g("div",null,"暂无数据")],-1)])]),default:t(()=>[l(v,{label:"序号",type:"index",width:"90"}),l(v,{"show-overflow-tooltip":"",prop:"pro_name",label:"项目名称",width:"100"}),l(v,{"show-overflow-tooltip":"",prop:"interface_url",label:"接口地址","min-width":"100"}),l(v,{"show-overflow-tooltip":"",prop:"describe",label:"bug描述","min-width":"100"}),l(v,{prop:"status",label:"bug状态","min-width":"40"},{default:t(a=>[a.row.status==="1"?(o(),r(p,{key:0,type:"danger"},{default:t(()=>[...e[22]||(e[22]=[u("未处理",-1)])]),_:1})):a.row.status==="2"?(o(),r(p,{key:1,type:"warning"},{default:t(()=>[...e[23]||(e[23]=[u("处理中",-1)])]),_:1})):a.row.status==="3"?(o(),r(p,{key:2,type:"success"},{default:t(()=>[...e[24]||(e[24]=[u("处理完",-1)])]),_:1})):a.row.status==="4"?(o(),r(p,{key:3,type:"info"},{default:t(()=>[...e[25]||(e[25]=[u("无效的",-1)])]),_:1})):A("",!0)]),_:1}),l(v,{prop:"level",label:"bug等级","min-width":"40"},{default:t(a=>[a.row.level==="1"?(o(),r(p,{key:0,type:"danger"},{default:t(()=>[...e[26]||(e[26]=[u("严重",-1)])]),_:1})):a.row.level==="2"?(o(),r(p,{key:1,type:"warning"},{default:t(()=>[...e[27]||(e[27]=[u("一般",-1)])]),_:1})):a.row.level==="3"?(o(),r(p,{key:2,type:"info"},{default:t(()=>[...e[28]||(e[28]=[u("轻微",-1)])]),_:1})):A("",!0)]),_:1}),l(v,{prop:"username",label:"创建人","min-width":"30"}),l(v,{label:"提交时间","min-width":"100"},{default:t(a=>[g("span",null,y(b(V).rTime(a.row.create_time)),1)]),_:1}),l(v,{prop:"update_time",label:"处理时间","min-width":"100"},{default:t(a=>[a.row.handle_time?(o(),z("span",Ie,y(b(V).rTime(a.row.handle_time)),1)):(o(),z("span",ze,"-"))]),_:1}),l(v,{"min-width":"150",label:"操作"},{default:t(a=>[l(f,{icon:"View",onClick:L=>Q(a.row),type:"success",plain:""},{default:t(()=>[...e[29]||(e[29]=[u("查看",-1)])]),_:1},8,["onClick"]),l(f,{icon:"Edit",onClick:L=>{n.updateBugDlg=!0,n.updateBugForm=a.row},type:"primary",plain:""},{default:t(()=>[...e[30]||(e[30]=[u("解决 ",-1)])]),_:1},8,["onClick"]),l(f,{icon:"Delete",onClick:L=>Y(a.row.id),type:"danger",plain:""},{default:t(()=>[...e[31]||(e[31]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,M.value]]),g("div",De,[l(ee,{"current-page":_.page,"onUpdate:currentPage":e[5]||(e[5]=a=>_.page=a),"page-size":_.size,"onUpdate:pageSize":e[6]||(e[6]=a=>_.size=a),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper",total:_.count,onCurrentChange:B,onSizeChange:B},null,8,["current-page","page-size","total"])])]),l(ue,{modelValue:n.showBug,"onUpdate:modelValue":e[8]||(e[8]=a=>n.showBug=a),"with-header":!1,size:"50%",direction:"rtl"},{footer:t(()=>[g("div",Le,[l(f,{type:"primary",onClick:e[7]||(e[7]=a=>n.showBug=!1),plain:""},{default:t(()=>[...e[42]||(e[42]=[u("确定",-1)])]),_:1})])]),default:t(()=>[e[43]||(e[43]=g("div",{class:"title"},"Bug详情",-1)),l(ne,null,{default:t(()=>[l(P,null,{default:t(()=>[e[39]||(e[39]=g("b",null,"bug信息",-1)),l(te,{column:5,direction:"vertical"},{default:t(()=>[l(D,{label:"接口地址",align:"center"},{default:t(()=>[n.bugInfo.interface_url.length<70?(o(),z("span",Ve,y(n.bugInfo.interface_url),1)):(o(),z("span",he,y(n.bugInfo.interface_url.slice(0,70))+"...",1))]),_:1}),l(D,{label:"创建人",align:"center"},{default:t(()=>[u(y(n.bugInfo.username),1)]),_:1}),l(D,{prop:"status",label:"bug状态",align:"center"},{default:t(()=>[n.bugInfo.status==="1"?(o(),r(p,{key:0,type:"danger"},{default:t(()=>[...e[32]||(e[32]=[u("未处理",-1)])]),_:1})):n.bugInfo.status==="2"?(o(),r(p,{key:1,type:"warning"},{default:t(()=>[...e[33]||(e[33]=[u("处理中",-1)])]),_:1})):n.bugInfo.status==="3"?(o(),r(p,{key:2,type:"success"},{default:t(()=>[...e[34]||(e[34]=[u("处理完",-1)])]),_:1})):n.bugInfo.status==="4"?(o(),r(p,{key:3,type:"info"},{default:t(()=>[...e[35]||(e[35]=[u("无效的",-1)])]),_:1})):A("",!0)]),_:1}),l(D,{prop:"level",label:"bug等级",align:"center"},{default:t(()=>[n.bugInfo.level==="1"?(o(),r(p,{key:0,type:"danger"},{default:t(()=>[...e[36]||(e[36]=[u("严重",-1)])]),_:1})):n.bugInfo.level==="2"?(o(),r(p,{key:1,type:"warning"},{default:t(()=>[...e[37]||(e[37]=[u("一般",-1)])]),_:1})):n.bugInfo.level==="3"?(o(),r(p,{key:2,type:"info"},{default:t(()=>[...e[38]||(e[38]=[u("轻微",-1)])]),_:1})):A("",!0)]),_:1}),l(D,{label:"提交时间",align:"center"},{default:t(()=>[u(y(b(V).rTime(n.bugInfo.create_time)),1)]),_:1})]),_:1})]),_:1}),n.bugLogs.info.url?(o(),r(P,{key:0,style:{margin:"5px 0","min-height":"400px"}},{default:t(()=>[e[40]||(e[40]=g("b",null,"用例执行信息",-1)),g("div",Ee,[l(be,{result:n.bugLogs.info,hideBtn:!0},null,8,["result"])])]),_:1})):(o(),r(G,{key:1,description:"暂无数据","image-size":150})),n.bugLogs?(o(),r(P,{key:2,style:{"min-height":"150px"}},{default:t(()=>[e[41]||(e[41]=g("b",null,"bug处理记录",-1)),g("div",$e,[l(ae,null,{default:t(()=>[(o(!0),z(J,null,ce(n.bugLogs.handle,(a,L)=>(o(),r(le,{key:L,timestamp:b(V).rDate(a.update_time),placement:"top"},{default:t(()=>[g("h4",null,y(a.handle.replace("【1】","【未处理】").replace("【2】","【处理中】").replace("【3】","【处理完】").replace("【4】","【无效的】")),1),g("p",null,y(a.update_user)+"操作于："+y(b(V).rTime(a.update_time)),1)]),_:2},1032,["timestamp"]))),128))]),_:1})])]),_:1})):(o(),r(G,{key:3,description:"暂无数据","image-size":150}))]),_:1})]),_:1},8,["modelValue"]),l(re,{title:"解决bug",modelValue:n.updateBugDlg,"onUpdate:modelValue":e[12]||(e[12]=a=>n.updateBugDlg=a),width:"30%",center:""},{footer:t(()=>[g("div",Fe,[l(f,{type:"primary",onClick:e[10]||(e[10]=a=>X(O.value)),plain:""},{default:t(()=>[...e[44]||(e[44]=[u("确定",-1)])]),_:1}),l(f,{onClick:e[11]||(e[11]=a=>n.updateBugDlg=!1),plain:""},{default:t(()=>[...e[45]||(e[45]=[u("取消",-1)])]),_:1})])]),default:t(()=>[l(ie,{model:n.updateBugForm,rules:W,ref_key:"formDataRef",ref:O},{default:t(()=>[l(se,{label:"bug状态：",prop:"status"},{default:t(()=>[l(oe,{style:{width:"100%"},modelValue:n.updateBugForm.status,"onUpdate:modelValue":e[9]||(e[9]=a=>n.updateBugForm.status=a),placeholder:"请选择bug状态",clearable:""},{default:t(()=>[l($,{label:"未处理",value:"1"}),l($,{label:"处理中",value:"2"}),l($,{label:"处理完",value:"3"}),l($,{label:"无效的",value:"4"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}},Ge=ye(Te,[["__scopeId","data-v-c6b822f5"]]);export{Ge as default};
