import{_ as G}from"./none-CwC0Lq_I.js";import{r as H,a as I,h as R,E as f,b as J}from"./index-Bqsb1G-Q.js";import{t as U}from"./dateTools-APCdG_Ih.js";import{a as c,v as _,o as K,D as Q,U as t,O as W,F as g,M as a,au as X,L as Y,ao as d,E,R as i,S as B,u as $}from"./vue-CXALzJrr.js";const Z={class:"card page_box",style:{padding:"10px"}},h={class:"pagination",style:{margin:"5px 5px 0"}},ee={style:{"text-align":"center"}},te={style:{"text-align":"center"}},se={__name:"Role",setup(le){const k=c([]),v=c(!1),p=_({id:0,name:"",description:""}),w=c(),A=_({name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{max:20,message:"角色名称不得超过20个字符",trigger:"blur"}],description:[{max:255,message:"描述不得超过255个字符",trigger:"blur"}]}),s=_({page:1,size:10,count:0}),V=c(!1);K(()=>{u()});async function u(){V.value=!0;const n={page:s.page,size:s.size},e=await H.getRole(n);e.status===200&&(k.value=e.data.results,s.count=e.data.count,V.value=!1)}function T(){v.value=!0}async function M(){if(!await w.value.validate().catch(()=>!1))return;const e=await R.roleApi.createRole(p);e.status===201?(f({type:"success",title:"已成功创建角色！",duration:1500}),await u(),v.value=!1):f({type:"error",title:"创建角色失败！",duration:1500,message:e.data.detail})}const y=c(!1),o=_({id:0,name:"",description:""}),C=c(),N=_({name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{max:20,message:"角色名称不得超过20个字符",trigger:"blur"}],description:[{max:255,message:"描述不得超过255个字符",trigger:"blur"}]});function S(n){y.value=!0,o.id=n.id,o.name=n.name,o.description=n.description}async function L(){if(!await C.value.validate().catch(()=>!1))return;const e=await R.roleApi.updateRole(o.id,o);e.status===200?(f({type:"success",title:"已成功更新角色！",duration:1500}),await u(),y.value=!1):f({title:"用户角色修改失败！",message:e.data.detail,type:"error",duration:1500})}async function q(n){I.confirm("此操作不可恢复，确认删除该角色吗？","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",center:!0}).then(async()=>{const e=await R.roleApi.deleteRole(n);e.status===204?(await u(),f({type:"success",title:"用户角色删除成功！",duration:1500})):f({title:"用户角色删除失败！",message:e.data.detail,type:"error",duration:1500})}).catch(()=>{J({type:"info",message:"已取消删除操作。",duration:1500})})}return(n,e)=>{const r=d("el-button"),m=d("el-table-column"),P=d("el-table"),j=d("el-pagination"),b=d("el-input"),x=d("el-form-item"),z=d("el-form"),D=d("el-dialog"),F=X("loading");return E(),Q("div",Z,[t(r,{plain:"",onClick:T,type:"primary",icon:"CirclePlus",size:"small"},{default:a(()=>[...e[12]||(e[12]=[i("角色",-1)])]),_:1}),t(r,{plain:"",onClick:u,type:"success",icon:"Refresh",size:"small"},{default:a(()=>[...e[13]||(e[13]=[i("刷新",-1)])]),_:1}),W((E(),Y(P,{data:k.value,style:{width:"100%"},stripe:"","header-cell-style":{"text-align":"center"},"cell-style":{"text-align":"center"},"element-loading-text":"加载中..."},{empty:a(()=>[...e[14]||(e[14]=[g("div",{class:"table-empty"},[g("img",{src:G,alt:"notData"}),g("div",null,"暂无数据")],-1)])]),default:a(()=>[t(m,{label:"序号",type:"index",width:"90"}),t(m,{label:"角色名称",prop:"name"}),t(m,{label:"角色描述",prop:"description"}),t(m,{prop:"create_time",label:"创建时间","min-width":"120"},{default:a(l=>[i(B($(U).rTime(l.row.create_time)),1)]),_:1}),t(m,{label:"更新时间","min-width":"120"},{default:a(l=>[i(B($(U).rTime(l.row.update_time)),1)]),_:1}),t(m,{label:"操作",width:"200"},{default:a(l=>[t(r,{type:"primary",icon:"Edit",onClick:O=>S(l.row),plain:""},{default:a(()=>[...e[15]||(e[15]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(r,{onClick:O=>q(l.row.id),icon:"Delete",type:"danger",plain:""},{default:a(()=>[...e[16]||(e[16]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,V.value]]),g("div",h,[t(j,{"current-page":s.page,"onUpdate:currentPage":e[0]||(e[0]=l=>s.page=l),"page-size":s.size,"onUpdate:pageSize":e[1]||(e[1]=l=>s.size=l),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper",total:s.count,onCurrentChange:u,onSizeChange:u},null,8,["current-page","page-size","total"])]),t(D,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=l=>v.value=l),title:"添加角色",width:"600",center:""},{default:a(()=>[t(z,{model:p,rules:A,ref_key:"createRef",ref:w,"label-width":"80px"},{default:a(()=>[t(x,{label:"角色名称",prop:"name"},{default:a(()=>[t(b,{modelValue:p.name,"onUpdate:modelValue":e[2]||(e[2]=l=>p.name=l),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(x,{label:"角色描述",prop:"description"},{default:a(()=>[t(b,{modelValue:p.description,"onUpdate:modelValue":e[3]||(e[3]=l=>p.description=l),placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1}),g("div",ee,[t(r,{type:"primary",onClick:e[4]||(e[4]=l=>M(w.value)),plain:""},{default:a(()=>[...e[17]||(e[17]=[i("保存",-1)])]),_:1}),t(r,{onClick:e[5]||(e[5]=l=>v.value=!1),plain:""},{default:a(()=>[...e[18]||(e[18]=[i("取消",-1)])]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(D,{modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=l=>y.value=l),title:"编辑角色",width:"600",center:""},{default:a(()=>[t(z,{model:o,rules:N,ref_key:"updateRef",ref:C,"label-width":"80px"},{default:a(()=>[t(x,{label:"角色名称",prop:"name"},{default:a(()=>[t(b,{modelValue:o.name,"onUpdate:modelValue":e[7]||(e[7]=l=>o.name=l),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(x,{label:"角色描述",prop:"description"},{default:a(()=>[t(b,{modelValue:o.description,"onUpdate:modelValue":e[8]||(e[8]=l=>o.description=l),placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1}),g("div",te,[t(r,{type:"primary",onClick:e[9]||(e[9]=l=>L(C.value)),plain:""},{default:a(()=>[...e[19]||(e[19]=[i("保存",-1)])]),_:1}),t(r,{onClick:e[10]||(e[10]=l=>y.value=!1),plain:""},{default:a(()=>[...e[20]||(e[20]=[i("取消",-1)])]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}};export{se as default};
