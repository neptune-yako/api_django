import{_ as de}from"./none-CwC0Lq_I.js";import{U as ue,h as C,E as w,a as pe,b as me}from"./index-Bqsb1G-Q.js";import{v as z,a as g,o as fe,D as x,F as d,U as t,O as ce,M as a,au as ge,L as $,u as s,q as S,T as B,ao as r,aE as _e,E as _,R as o,S as p,P as ve,a8 as J}from"./vue-CXALzJrr.js";import{P as ye}from"./ProStore-981bTmq_.js";import{t as E}from"./dateTools-APCdG_Ih.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const we={class:"card page-box",style:{padding:"10px"}},ke={key:0},Ve={key:1},xe={class:"pagination",style:{margin:"5px 5px 0"}},Ce={class:"dialog-footer"},De={class:"dialog-footer"},Pe={key:0,class:"project-detail"},je={class:"stat-item"},Ue={class:"stat-name"},ze={class:"stat-value"},Se={class:"bug-stat-item"},Ee={class:"bug-stat-name"},Le={class:"bug-stat-value"},Re={style:{"text-align":"center"}},$e={__name:"Project",setup(Be){const v=ye(),K=ue(),Q=_e(),y=z({page:1,size:10,count:0}),D=g(!1),b=g(null),L=g(!1);fe(()=>{k()});let T=g([]);async function k(){L.value=!0;const i={page:y.page,size:y.size},e=await C.projectApi.getProject(i);e.status===200&&(T.value=e.data.results,y.count=e.data.count,L.value=!1)}async function W(i){const e=await C.projectApi.getProjectDetail(i.id);e.status===200?(b.value=e.data,D.value=!0):w({title:"获取项目详情失败",type:"error",message:e.data.detail,duration:1500})}let m=g(!1),V=z({name:"",username:K.userInfo.username});function X(){m.value=!0}const Y=z({name:[{required:!0,message:"项目名称不能为空！",trigger:"blur"},{max:20,message:"项目名称长度在不能超过20个字符",trigger:"blur"}]}),A=g();async function Z(i){i.validate(async function(e){if(!e)return;const n=await C.projectApi.createProject(V);n.status===201?(w({title:"项目创建成功！",type:"success",duration:1500}),m.value=!1,await k()):w({title:"项目创建失败！",message:n.data.detail,type:"error",duration:1500})})}let f=g(!1),c=g({name:"",username:""});const h=z({name:[{required:!0,message:"项目名称不能为空！",trigger:"blur"},{max:20,message:"项目名称长度在不能超过20个字符",trigger:"blur"}]}),N=g();function ee(i){f.value=!0,c.value={...i}}async function te(i){i.validate(async function(e){if(!e)return;let n=c.value.id;const u=await C.projectApi.updateProject(n,c.value);u.status===200&&u.data.code!==300?(w({title:"项目修改成功！",message:`新项目名称为：${c.value.name}`,type:"success",duration:1500}),f.value=!1,await k()):w({title:"项目修改失败！",message:u.data.detail,type:"error",duration:1500})})}function ae(i){pe.confirm("此操作不可恢复，请确认是否要删除该项目?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",center:!0}).then(async()=>{const e=await C.projectApi.deleteProject(i);e.status===204?(w({type:"success",title:"已成功删除该项目！",duration:1500}),await k()):w({title:"项目删除失败！",type:"warning",message:e.data.detail,duration:1500})}).catch(()=>{me({type:"info",message:"已取消删除操作。",duration:1500})})}function le(i){v.$reset(),v.proList={id:i.id,name:i.name},v.isDisabled=!1,v.getEnvironmentList(),v.getInterFaceList(),v.getSceneList(),v.getPlanList(),w({title:"项目切换成功！",type:"success",message:`当前测试项目名称为：${i.name}`,duration:1500}),Q.push({name:"environment"})}return(i,e)=>{const n=r("el-button"),u=r("el-table-column"),M=r("el-tooltip"),oe=r("el-table"),ne=r("el-pagination"),P=r("el-input"),j=r("el-form-item"),q=r("el-form"),F=r("el-dialog"),U=r("el-descriptions-item"),se=r("el-descriptions"),I=r("el-divider"),O=r("el-card"),G=r("el-col"),H=r("el-row"),ie=r("el-drawer"),re=ge("loading");return _(),x(B,null,[d("div",we,[t(n,{plain:"",onClick:X,type:"primary",icon:"CirclePlus",size:"small"},{default:a(()=>[...e[14]||(e[14]=[o("项目",-1)])]),_:1}),t(n,{plain:"",onClick:k,type:"success",icon:"Refresh",size:"small"},{default:a(()=>[...e[15]||(e[15]=[o("刷新",-1)])]),_:1}),ce((_(),$(oe,{data:s(T),style:{width:"100%"},stripe:"","header-cell-style":{"text-align":"center"},"cell-style":{"text-align":"center"},"element-loading-text":"加载中..."},{empty:a(()=>[...e[16]||(e[16]=[d("div",{class:"table-empty"},[d("img",{src:de,alt:"notData"}),d("div",null,"暂无数据，请先创建项目才可以使用项目下的菜单！")],-1)])]),default:a(()=>[t(u,{label:"序号",type:"index",width:"90"}),t(u,{prop:"name",label:"项目名称","min-width":"140"}),t(u,{prop:"username",label:"创建人","min-width":"140"}),t(u,{label:"创建时间","min-width":"180"},{default:a(l=>[o(p(s(E).rTime(l.row.create_time)),1)]),_:1}),t(u,{label:"更新时间","min-width":"120"},{default:a(l=>[o(p(s(E).rTime(l.row.update_time)),1)]),_:1}),t(u,{label:"操作","min-width":"250"},{default:a(l=>[l.row.id===s(v).proList.id?(_(),x("div",ke,[t(n,{disabled:"",type:"success",icon:"Switch",plain:""},{default:a(()=>[...e[17]||(e[17]=[o("切换项目",-1)])]),_:1}),t(n,{disabled:"",plain:"",type:"success",icon:"View"},{default:a(()=>[...e[18]||(e[18]=[o("查看",-1)])]),_:1}),t(n,{disabled:"",plain:"",type:"primary",icon:"Edit"},{default:a(()=>[...e[19]||(e[19]=[o("编辑",-1)])]),_:1}),t(n,{disabled:"",plain:"",type:"danger",icon:"Delete"},{default:a(()=>[...e[20]||(e[20]=[o("删除",-1)])]),_:1})])):(_(),x("div",Ve,[t(M,{class:"box-item",effect:"dark",content:"切换测试项目，将获取该项目环境、接口、用例、计划、报告",placement:"top"},{default:a(()=>[t(n,{onClick:R=>le(l.row),type:"success",icon:"Switch",plain:""},{default:a(()=>[...e[21]||(e[21]=[o("切换项目",-1)])]),_:1},8,["onClick"])]),_:2},1024),t(n,{onClick:R=>W(l.row),type:"success",icon:"View",plain:""},{default:a(()=>[...e[22]||(e[22]=[o("查看",-1)])]),_:1},8,["onClick"]),t(n,{onClick:R=>ee(l.row),type:"primary",icon:"Edit",plain:""},{default:a(()=>[...e[23]||(e[23]=[o("编辑",-1)])]),_:1},8,["onClick"]),t(M,{class:"box-item",effect:"dark",content:"删除测试项目，将删除该项目下的所有环境、接口、用例、计划、报告",placement:"top"},{default:a(()=>[t(n,{onClick:R=>ae(l.row.id),type:"danger",icon:"Delete",plain:""},{default:a(()=>[...e[24]||(e[24]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]))]),_:1})]),_:1},8,["data"])),[[re,L.value]]),d("div",xe,[t(ne,{"current-page":y.page,"onUpdate:currentPage":e[0]||(e[0]=l=>y.page=l),"page-size":y.size,"onUpdate:pageSize":e[1]||(e[1]=l=>y.size=l),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next, jumper",total:y.count,onCurrentChange:k,onSizeChange:k},null,8,["current-page","page-size","total"])])]),t(F,{modelValue:s(m),"onUpdate:modelValue":e[6]||(e[6]=l=>S(m)?m.value=l:m=l),title:"添加项目",width:"600",center:""},{footer:a(()=>[d("span",Ce,[t(n,{type:"primary",onClick:e[4]||(e[4]=l=>Z(A.value)),plain:""},{default:a(()=>[...e[25]||(e[25]=[o("确认",-1)])]),_:1}),t(n,{onClick:e[5]||(e[5]=l=>S(m)?m.value=!1:m=!1),plain:""},{default:a(()=>[...e[26]||(e[26]=[o("取消",-1)])]),_:1})])]),default:a(()=>[t(q,{model:s(V),"label-width":"90",rules:Y,ref_key:"formDataRef",ref:A},{default:a(()=>[t(j,{label:"项目名称：",prop:"name","label-width":"100px"},{default:a(()=>[t(P,{modelValue:s(V).name,"onUpdate:modelValue":e[2]||(e[2]=l=>s(V).name=l),autocomplete:"off",placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),t(j,{label:"创建人：",prop:"username","label-width":"100px"},{default:a(()=>[t(P,{modelValue:s(V).username,"onUpdate:modelValue":e[3]||(e[3]=l=>s(V).username=l),autocomplete:"off",placeholder:"请输入创建人",disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(F,{modelValue:s(f),"onUpdate:modelValue":e[11]||(e[11]=l=>S(f)?f.value=l:f=l),title:"编辑项目",width:"600",center:""},{footer:a(()=>[d("span",De,[t(n,{type:"primary",onClick:e[9]||(e[9]=l=>te(N.value)),plain:""},{default:a(()=>[...e[27]||(e[27]=[o("确认",-1)])]),_:1}),t(n,{onClick:e[10]||(e[10]=l=>S(f)?f.value=!1:f=!1),plain:""},{default:a(()=>[...e[28]||(e[28]=[o("取消",-1)])]),_:1})])]),default:a(()=>[t(q,{model:s(c),"label-width":"90",rules:h,ref_key:"formUpdateDataRef",ref:N},{default:a(()=>[t(j,{label:"项目名称：",prop:"name","label-width":"100px"},{default:a(()=>[t(P,{modelValue:s(c).name,"onUpdate:modelValue":e[7]||(e[7]=l=>s(c).name=l),autocomplete:"off",placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),t(j,{label:"创建人：",prop:"username","label-width":"100px"},{default:a(()=>[t(P,{modelValue:s(c).username,"onUpdate:modelValue":e[8]||(e[8]=l=>s(c).username=l),autocomplete:"off",placeholder:"请输入创建人",disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(ie,{modelValue:D.value,"onUpdate:modelValue":e[13]||(e[13]=l=>D.value=l),"with-header":!1,direction:"rtl",size:"50%"},{footer:a(()=>[d("div",Re,[t(n,{onClick:e[12]||(e[12]=l=>D.value=!1),plain:"",type:"primary"},{default:a(()=>[...e[31]||(e[31]=[o("确定",-1)])]),_:1})])]),default:a(()=>[e[32]||(e[32]=d("div",{class:"title"},"项目详情",-1)),b.value?(_(),x("div",Pe,[t(se,{column:1,border:""},{default:a(()=>[t(U,{label:"项目名称",align:"center"},{default:a(()=>[o(p(b.value.name),1)]),_:1}),t(U,{label:"创建人",align:"center"},{default:a(()=>[o(p(b.value.username),1)]),_:1}),t(U,{label:"创建时间",align:"center"},{default:a(()=>[o(p(s(E).rTime(b.value.create_time)),1)]),_:1}),t(U,{label:"更新时间",align:"center"},{default:a(()=>[o(p(s(E).rTime(b.value.update_time)),1)]),_:1})]),_:1}),t(I,{"content-position":"center"},{default:a(()=>[...e[29]||(e[29]=[o("项目统计信息",-1)])]),_:1}),t(H,{gutter:20},{default:a(()=>[(_(!0),x(B,null,J(b.value.info,l=>(_(),$(G,{span:8,key:l.name},{default:a(()=>[t(O,{class:"stat-card"},{default:a(()=>[d("div",je,[d("div",Ue,p(l.name),1),d("div",ze,p(l.value)+"个",1)])]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(I,{"content-position":"center"},{default:a(()=>[...e[30]||(e[30]=[o("Bug统计信息",-1)])]),_:1}),t(H,{gutter:20},{default:a(()=>[(_(!0),x(B,null,J(b.value.bug,l=>(_(),$(G,{span:6,key:l.name},{default:a(()=>[t(O,{class:"bug-stat-card"},{default:a(()=>[d("div",Se,[d("div",Ee,p(l.name),1),d("div",Le,p(l.value)+"个",1)])]),_:2},1024)]),_:2},1024))),128))]),_:1})])):ve("",!0)]),_:1},8,["modelValue"])],64)}}},Ie=be($e,[["__scopeId","data-v-6bebdbf1"]]);export{Ie as default};
