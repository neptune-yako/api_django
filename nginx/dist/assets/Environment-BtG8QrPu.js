import{a as _,w as O,ao as p,D,E as h,U as l,M as t,R as V,F as i,e as Q,o as W,O as X,u as y,q as E,V as Y,T as P,a8 as Z,L as $,S as z}from"./vue-CXALzJrr.js";import{U as ee,h as S,E as U,a as le,b as te}from"./index-Bqsb1G-Q.js";import{P as ae}from"./ProStore-981bTmq_.js";import{_ as L}from"./Editor-CMLAlzEc.js";import{_ as oe}from"./none-CwC0Lq_I.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J="/assets/environment-C3Nltv_v.png",ne={__name:"DatabaseConfig",props:{configs:Array},emits:["updateConfigs"],setup(A,{emit:j}){const v=A,x=j,m=_([...v.configs]);O(m,d=>{x("updateConfigs",JSON.stringify(d,null,2))},{deep:!0}),O(()=>v.configs,d=>{m.value=[...d]},{deep:!0});const q=()=>{m.value.push({name:"aliyun",type:"mysql",config:{host:"",port:3306,user:"",password:"",database:""}})},w=d=>{m.value.splice(d,1)};return(d,u)=>{const c=p("el-input"),r=p("el-table-column"),f=p("el-option"),C=p("el-select"),b=p("el-button"),k=p("el-table");return h(),D("div",null,[l(k,{data:m.value,style:{width:"100%"},"header-cell-style":{"text-align":"center"},"cell-style":{"text-align":"center"},stripe:""},{empty:t(()=>[...u[0]||(u[0]=[i("div",{class:"table-empty"},[i("img",{src:oe,alt:"notData",width:"85"}),i("div",null,"暂无数据")],-1)])]),default:t(()=>[l(r,{prop:"name",label:"名称",width:"120"},{default:t(o=>[l(c,{modelValue:o.row.name,"onUpdate:modelValue":s=>o.row.name=s,clearable:"",placeholder:"请输入名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{prop:"type",label:"类型",width:"130"},{default:t(o=>[l(C,{modelValue:o.row.type,"onUpdate:modelValue":s=>o.row.type=s,clearable:"",placeholder:"请选择数据库类型"},{default:t(()=>[l(f,{label:"mysql",value:"mysql"}),l(f,{label:"oracle",value:"oracle"}),l(f,{label:"sqlserver",value:"sqlserver"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{prop:"config.host",label:"主机",width:"180"},{default:t(o=>[l(c,{modelValue:o.row.config.host,"onUpdate:modelValue":s=>o.row.config.host=s,clearable:"",placeholder:"请输入数据库服务ip"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{prop:"config.port",label:"端口",width:"120"},{default:t(o=>[l(c,{modelValue:o.row.config.port,"onUpdate:modelValue":s=>o.row.config.port=s,modelModifiers:{number:!0},type:"number",clearable:"",placeholder:"请输入数据库端口"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{prop:"config.database",label:"库名",width:"120"},{default:t(o=>[l(c,{modelValue:o.row.config.database,"onUpdate:modelValue":s=>o.row.config.database=s,clearable:"",placeholder:"请输入数据库名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{prop:"config.user",label:"用户",width:"120"},{default:t(o=>[l(c,{modelValue:o.row.config.user,"onUpdate:modelValue":s=>o.row.config.user=s,clearable:"",placeholder:"请输入数据库用户名"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{prop:"config.password",label:"密码",width:"120"},{default:t(o=>[l(c,{modelValue:o.row.config.password,"onUpdate:modelValue":s=>o.row.config.password=s,type:"password",clearable:"",placeholder:"请输入数据库密码"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(r,{label:"操作",width:"120"},{default:t(o=>[l(b,{onClick:s=>w(o.$index),plain:"",type:"danger",icon:"Delete",size:"small"},{default:t(()=>[...u[1]||(u[1]=[V("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(b,{onClick:q,plain:"",type:"primary",icon:"CirclePlus",size:"small"},{default:t(()=>[...u[2]||(u[2]=[V("添加",-1)])]),_:1})])}}},se=T(ne,[["__scopeId","data-v-ea8aac76"]]),ie={class:"main_box"},re={class:"card left_box"},de={class:"title_box"},ue={key:0},pe={key:1},me={class:"card center_box"},ce={class:"card right_box"},fe={class:"button"},_e={__name:"Environment",setup(A){const j=ee();let v=_([]);const x=ae();async function m(){const a=x.proList.id,e=await S.environmentApi.getEnvironment(a);e.status===200&&(v.value=e.data,x.envList=e.data)}async function q(){const a=await S.environmentApi.createEnvironment({project:x.proList.id,name:"测试环境",username:j.userInfo.username,host:"http://"});a.status===201?(U({title:"测试环境创建成功！",type:"success",duration:1500}),await m()):U({title:"环境创建失败！",message:a.data.detail,type:"error",duration:1500})}let w=_(""),d=_(""),u=_("{}"),c=_("[]"),r=_("{}"),f=_("{}"),C=_(""),b=_({});function k(a){b.value=a,x.env=a.id,w.value=a.name,d.value=a.host,u.value=a.headers,c.value=JSON.stringify(a.db,0,4)||"[]",r.value=a.global_variable,f.value=a.debug_global_variable,C.value=a.global_func}const o=a=>{c.value=a},s=Q(()=>{try{return JSON.parse(c.value)}catch{return[]}});W(async()=>{await m(),v.value.length>0&&k(v.value[0])});function F(){le.confirm("此操作不可恢复，确认要删除该测试环境?","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning",center:!0}).then(async()=>{const a=await S.environmentApi.deleteEnvironment(b.value.id);a.status===204?(U({title:"测试环境删除成功！",type:"success",duration:1500}),await m(),v.value.length>0&&k(v.value[0])):U({title:"环境删除失败！",message:a.data.detail,type:"error",duration:1500})}).catch(()=>{te({type:"info",message:"已取消删除操作。",duration:1500})})}async function R(){const a=b.value;a.name=a.name+"-复制";const e=await S.environmentApi.createEnvironment(a);e.status===201?(U({title:"测试环境复制成功！",type:"success",duration:1500}),await m()):U({title:"环境复制失败！",message:e.data.detail,type:"error",duration:1500})}async function G(){const a=b.value.id,e={name:w.value,host:d.value,global_func:C.value,db:JSON.parse(c.value),headers:u.value,global_variable:r.value,debug_global_variable:f.value},g=await S.environmentApi.updateEnvironment(a,e);g.status===200&&g.data.code!==300?(U({title:"测试环境保存成功！",type:"success",duration:1500}),await m()):U({title:"环境保存失败！",message:g.data.detail,type:"error",duration:1500})}return(a,e)=>{const g=p("el-button"),H=p("el-menu-item"),K=p("el-menu"),N=p("el-divider"),I=p("el-input"),B=p("el-tab-pane"),M=p("el-tabs");return h(),D(P,null,[i("div",ie,[i("div",re,[i("div",de,[e[8]||(e[8]=i("img",{src:J,width:"25",alt:""},null,-1)),e[9]||(e[9]=i("div",{class:"name"},"测试环境",-1)),l(g,{onClick:q,type:"primary",size:"small",icon:"CirclePlus",plain:""},{default:t(()=>[...e[6]||(e[6]=[V("环境",-1)])]),_:1}),l(g,{plain:"",onClick:m,type:"success",icon:"Refresh",size:"small"},{default:t(()=>[...e[7]||(e[7]=[V("刷新",-1)])]),_:1})]),l(K,{"default-active":y(b).id+""},{default:t(()=>[(h(!0),D(P,null,Z(y(v),n=>(h(),$(H,{onClick:ve=>k(n),index:n.id.toString(),key:"item.id"},{default:t(()=>[e[10]||(e[10]=i("img",{src:J,width:"20",style:{"margin-right":"10px"},alt:""},null,-1)),n.name.length<15?(h(),D("span",ue,z(n.name),1)):(h(),D("span",pe,z(n.name.slice(0,15))+"...",1))]),_:2},1032,["onClick","index"]))),128))]),_:1},8,["default-active"])]),i("div",me,[l(N,{"content-position":"center"},{default:t(()=>[...e[11]||(e[11]=[i("b",null,"基本信息",-1)])]),_:1}),l(I,{modelValue:y(w),"onUpdate:modelValue":e[0]||(e[0]=n=>E(w)?w.value=n:w=n),placeholder:"请输入环境名称",clearable:""},{prepend:t(()=>[...e[12]||(e[12]=[V("测试环境名称",-1)])]),_:1},8,["modelValue"]),l(I,{modelValue:y(d),"onUpdate:modelValue":e[1]||(e[1]=n=>E(d)?d.value=n:d=n),placeholder:"请输入base_url",style:{"margin-top":"5px"},clearable:""},{prepend:t(()=>[...e[13]||(e[13]=[V("服务器域名/IP",-1)])]),_:1},8,["modelValue"]),l(N,{"content-position":"center"},{default:t(()=>[...e[14]||(e[14]=[i("b",null,"请求头/数据库",-1)])]),_:1}),l(M,{type:"border-card",stretch:""},{default:t(()=>[l(B,{label:"全局请求头"},{default:t(()=>[l(L,{lang:"json",modelValue:y(u),"onUpdate:modelValue":e[2]||(e[2]=n=>E(u)?u.value=n:u=n)},null,8,["modelValue"])]),_:1}),l(B,{label:"数据库"},{default:t(()=>[l(se,{configs:s.value,onUpdateConfigs:o},null,8,["configs"])]),_:1})]),_:1}),l(N,{"content-position":"center"},{default:t(()=>[...e[15]||(e[15]=[i("b",null,"全局变量",-1)])]),_:1}),l(M,{type:"border-card",stretch:""},{default:t(()=>[l(B,{label:"全局变量"},{default:t(()=>[l(L,{lang:"json",modelValue:y(r),"onUpdate:modelValue":e[3]||(e[3]=n=>E(r)?r.value=n:r=n)},null,8,["modelValue"])]),_:1}),l(B,{label:"调试全局变量"},{default:t(()=>[l(L,{lang:"json",modelValue:y(f),"onUpdate:modelValue":e[4]||(e[4]=n=>E(f)?f.value=n:f=n)},null,8,["modelValue"])]),_:1})]),_:1})]),i("div",ce,[l(N,{"content-position":"center"},{default:t(()=>[...e[16]||(e[16]=[i("b",null,"全局工具函数",-1)])]),_:1}),l(L,{lang:"python",modelValue:y(C),"onUpdate:modelValue":e[5]||(e[5]=n=>E(C)?C.value=n:C=n)},null,8,["modelValue"])])]),X(i("div",fe,[l(g,{onClick:G,type:"primary",plain:"",icon:"FolderChecked"},{default:t(()=>[...e[17]||(e[17]=[V("保存",-1)])]),_:1}),l(g,{onClick:R,type:"primary",plain:"",icon:"DocumentCopy"},{default:t(()=>[...e[18]||(e[18]=[V("复制",-1)])]),_:1}),l(g,{onClick:F,type:"danger",plain:"",icon:"Delete"},{default:t(()=>[...e[19]||(e[19]=[V("删除",-1)])]),_:1})],512),[[Y,y(b).id]])],64)}}},Ue=T(_e,[["__scopeId","data-v-035e7153"]]);export{Ue as default};
